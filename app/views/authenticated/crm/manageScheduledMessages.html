<md-dialog aria-label="segmentInteractionForm" class="crmInterationDialog">
    <md-toolbar class="md-primary">
        <div class="md-toolbar-tools">
            <h3 flex> Scheduled Message </h3>
            <span layout layout-align="end center" flex>
                <span class="close" ng-click="fnCloseDialog()">X</span>
            </span>
        </div>
    </md-toolbar>

    <md-content layout="row" style="height: calc(100% - 40px); overflow: hidden;">

        <!-- Form Section -->
        <div class="shadow formSection"  layout-margin flex="40">
            <md-whiteframe class="md-whiteframe-z1 contentHeader" layout layout-align="start center">
                <h3 style="margin: 16px"> Segment Info </h3>
            </md-whiteframe>
            <form name="manageCrmInteractionForm" layout-padding novalidate>
                <md-input-container>
                    <label>Segment</label>
                    <input type="text" ng-model="crmInteraction.segment.name" disabled />
                </md-input-container>
                <md-input-container>
                    <label>Due Date</label>
                    <input type="text" ng-model="crmInteraction.due_date" disabled />
                </md-input-container>
                <md-input-container>
                    <label>Template Name</label>
                    <input type="text" ng-model="crmInteraction.sub_segment.template_name" disabled />
                </md-input-container>
                <md-input-container>
                    <label>Scheduled Days</label>
                    <input type="number" ng-model="crmInteraction.sub_segment.interaction_delay_days" disabled />
                </md-input-container>
                <md-input-container>
                    <label>Delivery Type</label>
                    <input type="text" ng-model="crmInteraction.delivery_type" disabled />
                </md-input-container>
                <md-input-container>
                    <label>Status</label>
                    <input type="text" ng-model="crmInteraction.status" disabled />
                </md-input-container>
            </form>
        </div>

        <!-- Preview Section -->
        <div class="shadow previewSection" layout-margin flex>

            <!-- Header section -->
            <md-whiteframe class="md-whiteframe-z1 contentHeader" layout layout-align="start center">
                <h3 style="margin-left: 16px">RO #{{repairOrder.order_number}}</h3>
            </md-whiteframe>

            <!-- Content section -->
            <div ng-if="!repairOrder" layout-margin layout-padding>
                Repair orders not available.</div>
            <md-content class="sticky-container roListContainer" ng-if="repairOrder">
                <!-- Customer Info-->
                <div layout-margin class="shadow">
                    <md-whiteframe class="md-whiteframe-z1 contentHeader" layout layout-align="center center">
                        <h3>Customer Info</h3>
                    </md-whiteframe>
                    <div layout="row" layout-sm="column" layout-margin>
                        <div layout="row" flex>
                            <label class="leftLabel">Name:</label>
                            <label flex>{{crmInteraction.customer.first_name}}&nbsp;{{crmInteraction.customer.last_name}}</label>
                        </div>
                        <div layout="row" flex>
                            <label class="leftLabel">Company:</label>
                            <label flex>{{crmInteraction.customer.company}}</label>
                        </div>
                    </div>
                    <div layout="row" layout-sm="column" layout-margin>
                        <div layout="row" flex>
                            <label class="leftLabel">Address 1:</label>
                            <label flex>{{crmInteraction.customer.address1}}</label>
                        </div>
                        <div layout="row" flex>
                            <label class="leftLabel">Postal Code:</label>
                            <label flex>{{crmInteraction.customer.postal_code}}</label>
                        </div>
                    </div>
                    <div layout="row" layout-sm="column" layout-margin>
                        <div layout="row" flex>
                            <label class="leftLabel">City:</label>
                            <label flex>{{crmInteraction.customer.city}}</label>
                        </div>
                        <div layout="row" flex>
                            <label class="leftLabel">Phone Number:</label>
                            <label flex>{{crmInteraction.customer.phone_numbers[0]}}</label>
                        </div>
                    </div>
                    <div layout="row" layout-sm="column" layout-margin>
                        <div layout="row" flex>
                            <label class="leftLabel">State:</label>
                            <label flex>{{crmInteraction.customer.state}}</label>
                        </div>
                        <div layout="row" flex>
                            <label class="leftLabel">Email:</label>
                            <label flex>{{crmInteraction.customer.email_addresses[0]}}</label>
                        </div>
                    </div>
                    <div layout="row" layout-sm="column" layout-margin>
                        <div layout="row" flex>
                            <label class="leftLabel">Marketing Source:</label>
                            <label flex>{{repairOrder.marketing_source}}</label>
                        </div>
                    </div>
                </div>
                <!-- Vehicles Info-->
                <div layout-margin class="shadow">
                    <md-whiteframe class="md-whiteframe-z1 contentHeader" layout layout-align="center center">
                        <h3>Vehicles Info</h3>
                    </md-whiteframe>
                    <div layout="row" layout-sm="column" layout-margin>
                        <div layout="row" flex>
                            <label class="leftLabel">Model:</label>
                            <label flex>{{crmInteraction.vehicle.model}}</label>
                        </div>
                        <div layout="row" flex>
                            <label class="leftLabel">Make:</label>
                            <label flex>{{crmInteraction.vehicle.make}}</label>
                        </div>
                    </div>
                    <div layout="row" layout-sm="column" layout-margin>
                        <div layout="row" flex>
                            <label class="leftLabel">License:</label>
                            <label flex>{{crmInteraction.vehicle.license}}</label>
                        </div>
                        <div layout="row" flex>
                            <label class="leftLabel">Year:</label>
                            <label flex>{{crmInteraction.vehicle.year}}</label>
                        </div>
                    </div>
                    <div layout="row" layout-sm="column" layout-margin>
                        <div layout="row" flex>
                            <label class="leftLabel">Mileage:</label>
                            <label flex>{{crmInteraction.vehicle.last_odo}}</label>
                        </div>
                    </div>
                </div>
                <!-- Service Advisor -->
                <div layout-margin class="shadow">
                    <md-whiteframe class="md-whiteframe-z1 contentHeader" layout layout-align="center center">
                        <h3>Service Details</h3>
                    </md-whiteframe>
                    <div layout="row" layout-sm="column" layout-margin>
                        <div layout="row" flex>
                            <label class="leftLabel">Service Advisor:</label>
                            <label flex>{{repairOrder.writer.full_name}}</label>
                        </div>
                        <div layout="row" flex>
                            <label class="leftLabel">Technician:</label>
                            <label flex>{{repairOrder.technician_name}}</label>
                        </div>
                    </div>
                    <div layout="row" layout-sm="column" layout-margin>
                        <div layout="row" flex>
                            <label class="leftLabel">Arrived:</label>
                            <label flex>{{repairOrder.opened | date :'MM/dd/yyyy h:mm a'}}</label>
                        </div>
                        <div layout="row" flex>
                            <label class="leftLabel">Status:</label>
                            <label flex>{{repairOrder.order_status}}</label>
                        </div>
                    </div>
                    <div layout="row" layout-sm="column" layout-margin>
                        <div layout="row" flex>
                            <label class="leftLabel">Closed:</label>
                            <label flex>{{repairOrder.closed | date :'MM/dd/yyyy h:mm a'}}</label>
                        </div>
                    </div>
                    <div layout="row" layout-margin>
                        <div flex>
                            <md-subheader class="subHeader">Labor Details</md-subheader>
                            <div class="border">
                                <div ng-if="repairOrder.labor.length == 0" layout-margin layout-padding>
                                    Labor details not available.
                                </div>
                                <md-list>
                                    <md-item ng-repeat="labor in repairOrder.labor">
                                        <md-item-content>
                                            <div class="md-tile-content">
                                                <h3 style="padding-bottom: 2px; font-weight: bold">{{labor.tech.full_name}}</h3>
                                                <h4>
                                                    <div layout="row" layout-md="column" layout-sm="column">
                                                        <span><span class="leftLabel"> Price: </span>{{ labor.sold_price_cents ? labor.sold_price_cents : 0 | CentToDollar | currency }}<span hide-sm hide-md>&nbsp;|&nbsp;</span></span>
                                                        <span><span class="leftLabel"> Cost: </span>{{labor.actual_cost_cents ? labor.actual_cost_cents : 0 | CentToDollar | currency}}<span hide-sm hide-md>&nbsp;|&nbsp;</span></span>
                                                        <span>
                                                            <span class="leftLabel"> Gross Profit: </span>{{ labor.sold_price_cents - labor.actual_cost_cents | CentToDollar | currency }}
                                                            ({{ labor.sold_price_cents == 0 ? 0 : ((labor.sold_price_cents - labor.actual_cost_cents) / labor.sold_price_cents) * 100 | number:2 }}%)
                                                        </span>
                                                    </div>
                                                </h4>
                                                <p>{{labor.description}}</p>
                                            </div>
                                        </md-item-content>
                                    </md-item>
                                </md-list>
                            </div>
                        </div>
                    </div>
                    <div layout="row" layout-margin>
                        <div flex>
                            <md-subheader class="subHeader">Parts Details</md-subheader>
                            <div class="border">
                                <div ng-if="repairOrder.parts.length == 0" layout-margin layout-padding>
                                    Parts details not available.
                                </div>
                                <md-list>
                                    <md-item ng-repeat="part in repairOrder.parts">
                                        <md-item-content>
                                            <div class="md-tile-content">
                                                <h3 style="padding-bottom: 2px; font-weight: bold">{{part.tech.full_name}}</h3>
                                                <h3 style="padding-bottom: 2px;"><span class="leftLabel"> Number: </span> {{part.part_num}}</h3>
                                                <h4>
                                                    <div layout="row" layout-md="column" layout-sm="column" >
                                                        <span><span class="leftLabel"> Price: </span>{{ part.sold_price_cents ? part.sold_price_cents : 0 | CentToDollar | currency }}<span hide-sm hide-md>&nbsp;|&nbsp;</span></span>
                                                        <span><span class="leftLabel"> Cost: </span>{{part.actual_cost_cents ? part.actual_cost_cents : 0 | CentToDollar | currency}}<span hide-sm hide-md>&nbsp;|&nbsp;</span></span>
                                                        <span><span class="leftLabel"> Qty: </span>{{part.quantity ? part.quantity : 0 | toFloor}}<span hide-sm hide-md>&nbsp;|&nbsp;</span></span>
                                                        <span>
                                                            <span class="leftLabel"> Gross Profit: </span>{{ part.sold_price_cents - part.actual_cost_cents | CentToDollar | currency }}
                                                                ({{ part.sold_price_cents == 0 ? 0 : ((part.sold_price_cents - part.actual_cost_cents) / part.sold_price_cents) * 100 | number:2 }}%)
                                                        </span>
                                                    </div>
                                                </h4>
                                                <p>{{part.description}}</p>
                                            </div>
                                        </md-item-content>
                                    </md-item>
                                </md-list>
                            </div>
                        </div>
                    </div>
                    <div layout="row" layout-margin>
                        <div flex>
                            <md-subheader class="subHeader">Sublet Details</md-subheader>
                            <div class="border">
                                <div ng-if="repairOrder.sublets.length == 0" layout-margin layout-padding>
                                    Sublet details not available.
                                </div>
                                <md-list>
                                    <md-item ng-repeat="sublet in repairOrder.sublets">
                                        <md-item-content>
                                            <div class="md-tile-content">
                                                <h3 style="padding-bottom: 2px;"><span class="leftLabel"> Order ID: </span> #{{sublet.id}}</h3>
                                                <h4>
                                                    <div layout="row" layout-md="column" layout-sm="column">
                                                        <span layout="row"><span class="leftLabel"> Price: </span>{{ sublet.sold_price_cents ? sublet.sold_price_cents : 0 | CentToDollar | currency }}<span hide-sm hide-md>&nbsp;|&nbsp;</span></span>
                                                        <span><span class="leftLabel"> Cost: </span>{{sublet.actual_cost_cents ? sublet.actual_cost_cents : 0 | CentToDollar | currency}}<span hide-sm hide-md>&nbsp;|&nbsp;</span></span>
                                                        <span>
                                                            <span class="leftLabel"> Gross Profit: </span>{{ sublet.sold_price_cents - sublet.actual_cost_cents | CentToDollar | currency }}
                                                                ({{ sublet.sold_price_cents == 0 ? 0 : ((sublet.sold_price_cents - sublet.actual_cost_cents) / sublet.sold_price_cents) * 100 | number:2 }}%)
                                                        </span>
                                                    </div>
                                                </h4>
                                                <p>{{sublet.description}}</p>
                                            </div>
                                        </md-item-content>
                                    </md-item>
                                </md-list>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Recommended Section -->
                <div layout-margin class="shadow">
                    <md-whiteframe class="md-whiteframe-z1 contentHeader" layout="row" layout-align="center center">
                        <h3> Recommended Items </h3>
                    </md-whiteframe>
                    <div ng-if="repairOrder.recommendations == null" layout="row" layout-align="center center"
                         layout-margin layout-padding  flex>
                        <h2>No recommended items available.</h2>
                    </div>
                    <div layout="column" ng-if="repairOrder.recommendations != null" layout-sm="column" layout-margin>
                        <md-list>
                            <md-item ng-repeat="recItem in repairOrder.recommendations">
                                <md-item-content>
                                    <div class="md-tile-content">
                                        <h3 style="padding-bottom: 2px; font-weight: bold">{{recItem.recommendation_type}}</h3>
                                        <h4 layout="column">
                                            <div><span class="leftLabel"> Operation Code: </span> {{recItem.operation_code}} </div>
                                            <div><span class="leftLabel"> Due Date: </span>
                                                {{recItem.due_date | date :'MM/dd/yyyy h:mm a'}} </div>
                                            <div><span class="leftLabel"> Recommended Date: </span>
                                                {{recItem.recommended_date | date: 'MM/dd/yyyy h:mm a'}} </div>
                                        </h4>
                                        <p>{{recItem.text}}</p>
                                    </div>
                                </md-item-content>
                            </md-item>
                        </md-list>
                    </div>
                </div>
                <!-- Inspection -->
                <div layout-margin class="shadow">
                    <md-whiteframe class="md-whiteframe-z1 contentHeader" layout layout-align="center center">
                        <h3>Inspection</h3>
                    </md-whiteframe>
                    <div ng-if="repairOrder.inspection == null" layout="row" layout-align="center center"
                         layout-margin layout-padding  flex>
                        <h2>No inspection available.</h2>
                    </div>
                    <div layout="column" ng-if="repairOrder.inspection!=null" layout-sm="column" layout-margin>
                        <div layout="row" layout-sm="column" layout-margin>
                            <div layout="row" flex>
                                <label class="leftLabel">ID :</label>
                                <label flex>{{repairOrder.inspection.id}}</label>
                            </div>
                            <div layout="row" flex>
                                <label class="leftLabel">Repair Order ID :</label>
                                <label flex>{{repairOrder.inspection.repairOrderId}}</label>
                            </div>
                        </div>
                        <div style="overflow: auto"><!--max-height: 350px;-->
                            <div ng-repeat="(key, value) in repairOrder.inspection.inspectionDefinition.inspectedItemDefinitions | groupBy: 'category'" layout="column" layout-sm="column" layout-margin>
                                <div ng-repeat="(locKey, locVal) in value | groupBy: 'location'" layout="column" layout-sm="column" layout-margin>
                                    <h3><span>{{ key }}&nbsp;</span><span ng-if="locKey">-&nbsp;{{locKey}}</span></h3>
                                    <div layout="row" layout-sm="column">
                                        <div class="datagrid" style="overflow-y: hidden;">
                                            <table>
                                                <thead>
                                                <tr><th>Description</th><th>Location</th><th>Before Status</th><th>Before Value</th>
                                                    <th>After Status</th><th>After Value</th><th>Notes</th><th>Due Days</th></tr>
                                                </thead>
                                                <tbody>
                                                <tr ng-repeat="val in locVal" ng-init="fnInitInspectedItems(val.name,repairOrder.inspection.inspectedItems)">
                                                    <td>{{item[val.name].description}}</td>
                                                    <td>{{locKey}}</td>
                                                    <td>
                                                        <div ng-if="item[val.name].beforeStatus == 'green'" class="checked_item checked_item_green"></div>
                                                        <div ng-if="item[val.name].beforeStatus == 'red'" class="checked_item checked_item_red"></div>
                                                        <div ng-if="item[val.name].beforeStatus == 'yellow'" class="checked_item checked_item_yellow"></div>
                                                    </td>
                                                    <td>{{item[val.name].beforeValue}}</td>
                                                    <td>{{item[val.name].afterStatus}}</td>
                                                    <td>{{item[val.name].afterValue}}</td>
                                                    <td>{{item[val.name].notes}}</td>
                                                    <td>{{item[val.name].dueDays}}</td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </md-content>
        </div>
    </md-content>
</md-dialog>