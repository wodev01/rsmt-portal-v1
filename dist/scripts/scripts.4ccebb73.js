"use strict";var app=angular.module("rsmtPortalApp",["ngAnimate","ngCookies","angular.filter","ngSanitize","ui.router","ngMaterial","ui.grid","ui.grid.selection","ui.grid.autoResize","ngMap","ui.grid.pagination","angular-bind-html-compile"]).constant("cookieName","cargly_rsmt_access_token").constant("localStorage",localStorage).constant("globalTimeZone",["US/Hawaii","US/Alaska","US/Pacific","US/Arizona","US/Mountain","US/Central","US/Eastern"]).constant("toastr",toastr);app.config(["$mdThemingProvider","toastr","$urlRouterProvider","$stateProvider",function(a,b,c,d){a.definePalette("rsmtPalette",{50:"BDBDBD",100:"9E9E9E",200:"757575",300:"616161",400:"424242",500:"212121",600:"e53935",700:"424242",800:"212121",900:"000000",A100:"ff8a80",A200:"ff5252",A400:"ff1744",A700:"d50000",contrastDefaultColor:"light",contrastDarkColors:["50","100","200","300","400","A100"],contrastLightColors:void 0}),a.theme("rsmt").primaryPalette("rsmtPalette").accentPalette("blue"),a.theme("indigo").primaryPalette("indigo").accentPalette("blue"),a.theme("grey").primaryPalette("grey").accentPalette("blue"),a.setDefaultTheme("rsmt"),a.alwaysWatchTheme(!0),b.options={closeButton:!0,debug:!1,newestOnTop:!0,progressBar:!0,positionClass:"toast-top-right",preventDuplicates:!0,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},c.otherwise("/login"),d.state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginCtrl",data:{pageTitle:"Login"},resolve:{AuthService:["AuthService",function(a){return a.fnAuthTokenUndefined()}]}}).state("resetPassword",{url:"/reset-password",templateUrl:"views/resetPassword.html",controller:"ResetPasswordCtrl",data:{pageTitle:"Reset Password"},resolve:{AuthService:["AuthService",function(a){return a.fnResetPWTokenVerified()}]}}).state("verify",{url:"/verify",templateUrl:"views/authenticated/verify/verify.html",controller:"VerifyCtrl",data:{pageTitle:"User Verify"},resolve:{AuthService:["AuthService",function(a){return a.fnGetUser()}]}}).state("payment",{url:"/payment",templateUrl:"views/authenticated/payment/payment.html",controller:"PaymentCtrl",data:{pageTitle:"Payment"},resolve:{AuthService:["AuthService",function(a){return a.fnGetUser()}]}}).state("main",{"abstract":!0,url:"/",controller:"MainCtrl",templateUrl:"views/authenticated/main.html"}).state("main.dashboard",{url:"dashboard",controller:"DashboardCtrl",templateUrl:"views/authenticated/dashboard/dashboard.html",data:{pageTitle:"Dashboard"},resolve:{AuthService:["AuthService",function(a){return a.fnGetUser("realtime_dashboard")}]}}).state("main.locations",{url:"locations",controller:"LocationsCtrl",templateUrl:"views/authenticated/locations/locations.html",data:{pageTitle:"Locations"},resolve:{AuthService:["AuthService",function(a){return a.fnGetUser()}]}}).state("main.crm",{url:"crm",controller:"CrmCtrl",templateUrl:"views/authenticated/crm/crm.html",data:{pageTitle:"CRM"},resolve:{AuthService:["AuthService",function(a){return a.fnGetUser("crm_scheduled")}]}}).state("main.products",{url:"products",controller:"ProductsCtrl",templateUrl:"views/authenticated/products/products.html",data:{pageTitle:"Products"},resolve:{AuthService:["AuthService",function(a){return a.fnGetUser()}]}}).state("main.locationSetup",{url:"location/setup",controller:"LocationSetupCtrl",templateUrl:"views/authenticated/locationSetup/locationSetup.html",data:{pageTitle:"Location Setup"},resolve:{AuthService:["AuthService",function(a){return a.fnGetUser("realtime_dashboard")}]}}).state("main.settings",{url:"settings/:settingsName",controller:"SettingsCtrl",templateUrl:"views/authenticated/settings/settings.html",data:{pageTitle:"Settings"},resolve:{AuthService:["AuthService",function(a){return a.fnGetUser()}]}})}]),app.run(["$rootScope","$mdDialog","$mdSidenav","$cookies","cookieName",function(a,b,c,d,e){a.fnReturnGridHeight=function(a,b,c,d){var e=50,f=30,g=32,h=18,i=f+(d?25:0),j=a*(b?b:e)+h,k=c?g:0;return{height:i+j+k+"px"}},a.fnCancelSearchFilter=function(a,b){27===a.keyCode&&b.searchForm.searchFilter.$rollbackViewValue()},a.fnCloseSideNavs=function(){var a=angular.element("md-sidenav");angular.forEach(a,function(a){var b=angular.element(a).attr("md-component-id");c(b).isOpen()&&c(b).close().then(function(){})})},CarglyPartner.configure({applicationId:"bTkSVhhdCDKmJU1KrE9nmwBllTl8iQ9r",appLabel:"rsmt",onTwoMinWarning:function(){var a=["$scope","$mdDialog","$interval",function(a,b,c){a.countdown,a.minRemaining=60,a.fnCloseDialog=function(){b.cancel()};c(function(){0===a.countdown&&(c.cancel(),a.fnCloseDialog()),a.countdown-=1},1e3);a.$watch("countdown",function(b){a.minRemaining=parseInt(b/60)+1}),a.extendSession=function(){a.fnCloseDialog(),CarglyPartner.extendSession(function(){},function(){})}}],c=d.get(e);c&&b.show({controller:a,templateUrl:"views/modals/idleSession.tmpl.html",clickOutsideToClose:!1})},onAuthChanged:function(){}});var f={Android:function(){return navigator.userAgent.match(/Android/i)||navigator.platform.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)||navigator.platform.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)||navigator.platform.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return f.Android()||f.BlackBerry()||f.iOS()||f.Opera()||f.Windows()}};a.isMobile=f.any()}]),app.directive("passwordVerify",function(){return{require:"ngModel",scope:{passwordVerify:"="},link:function(a,b,c,d){a.$watch(function(){var b;return(a.passwordVerify||d.$viewValue)&&(b=a.passwordVerify+"_"+d.$viewValue),b},function(b){b&&d.$parsers.unshift(function(b){var c=a.passwordVerify;return c!==b?void d.$setValidity("passwordVerify",!1):(d.$setValidity("passwordVerify",!0),b)})})}}}),app.directive("pageTitle",["$rootScope","$timeout",function(a,b){return{link:function(c,d){function e(a){return a.charAt(0).toUpperCase()+a.slice(1)}function f(a,c){var f="Rlo training";a.data&&a.data.pageTitle&&(f="Settings"===a.data.pageTitle?e(c.settingsName)+" "+a.data.pageTitle+" - "+f:a.data.pageTitle+" - "+f),b(function(){d.text(f)})}var g=a.$on("$stateChangeStart",function(a,b,c){f(b,c)});a.$on("$destroy",g);var h=a.$on("$stateChangeError",function(a,b,c,d,e){f(d,e)});a.$on("$destroy",h)}}}]),app.directive("recommendedGrid",["$mdDialog","allCustomerService",function(a,b){return{restrict:"EA",scope:{locId:"=",vehicleId:"="},templateUrl:"views/authenticated/crm/shopLocationsRS.html",link:function(a){a.isRSDataNotNull=a.isRSMsgShow=!1;var c=null,d=null;a.$watch("vehicleId",function(b){c=b,b&&(a.fnSetWatchOnGrid(b),a.fnSetGridOptions(b),a.getPagedDataAsync(a.pagingOptions.pageSize,a.pagingOptions.currentPage,a.recommendedServiceFilterOptions.filterText))}),a.$watch("locId",function(b){d=b,b&&(a.fnSetGridOptions(),a.getPagedDataAsync())}),a.recommendedServiceFilterOptions={filterText:"",useExternalFilter:!1},a.recommendedServiceTotalServerItems=0,a.pagingOptions={pageSizes:[5,10,25,50],pageSize:5,currentPage:1},a.setPagingData=function(b,d,e){var f=c?b.slice((d-1)*e,d*e):b;a.recommendedServicesData=f,a.recommendedServiceTotalServerItems=b.length},a.getPagedDataAsync=function(e,f){d?b.recommendedService(d).then(function(b){0!==b.length?(a.isRSDataNotNull=!0,a.isRSMsgShow=!1,a.setPagingData(b,f,e)):(a.isRSDataNotNull=!1,a.isRSMsgShow=!0)}):c&&b.customerVehiclesRS(c).then(function(b){0!==b.length?(a.isRSDataNotNull=!0,a.isRSMsgShow=!1,a.setPagingData(b,f,e)):(a.isRSDataNotNull=!1,a.isRSMsgShow=!0)})},a.fnSetWatchOnGrid=function(b){b&&(a.$watch("pagingOptions",function(b,c){b!==c&&(b.currentPage===c.currentPage&&1!==c.currentPage?a.pagingOptions.currentPage=1:a.getPagedDataAsync(a.pagingOptions.pageSize,a.pagingOptions.currentPage,a.recommendedServiceFilterOptions.filterText))},!0),a.$watch("filterOptions",function(b,c){b!==c&&a.getPagedDataAsync(a.pagingOptions.pageSize,a.pagingOptions.currentPage,a.recommendedServiceFilterOptions.filterText)},!0))},a.fnSetGridOptions=function(b){var c=[{field:"text",displayName:"Service",minWidth:200,enableHiding:!1},{field:"recommended_date",displayName:"Date",cellFilter:"date:'MM/dd/yyyy h:mm a'",minWidth:200,enableHiding:!1},{field:"due_date",displayName:"Due Date",cellFilter:"date:'MM/dd/yyyy h:mm a'",minWidth:200,enableHiding:!1},{field:"recommendation_type",displayName:"Type",minWidth:100,enableHiding:!1}];a.tooltip='<div class="grid-tooltip custom-table" add-tooltip obj="row"></div>',b||(c.unshift({cellTemplate:a.tooltip,displayName:"Recent Labor",minWidth:50,width:120,sortable:!1}),c.push({field:"customer.first_name",displayName:"Customer Name",cellTemplate:'<div class="ui-grid-cell-contents">{{row.getProperty(col.field)}} {{row.entity.customer.last_name}}</div>',minWidth:220,enableHiding:!1},{field:"customer.phone_numbers",displayName:"Phone Numbers",cellFilter:"joinArray",minWidth:100,enableHiding:!1})),a.recommendedServiceGridOptions={data:"recommendedServicesData",rowHeight:50,enableRowSelection:!0,enableRowHeaderSelection:!1,enableVerticalScrollbar:0,filterOptions:a.recommendedServiceFilterOptions,multiSelect:!1,columnDefs:c,onRegisterApi:function(b){b.selection.on.rowSelectionChanged(a,function(a){a.isSelected=!0})}}}}}}]),app.directive("repairOrderGrid",["$mdDialog","allCustomerService",function(a,b){return{restrict:"EA",scope:{locId:"=",vehicleId:"="},templateUrl:"views/authenticated/crm/shopLocationsRO.html",link:function(c){c.isRODataNotNull=c.isROMsgShow=!1;var d=null,e=null;c.$watch("vehicleId",function(a){d=a,a&&(c.fnSetGridOptions(),c.getPagedDataAsync())}),c.$watch("locId",function(a){e=a,a&&(c.fnSetWatchOnGrid(a),c.fnSetGridOptions(a),c.getPagedDataAsync(c.pagingOptions.pageSize,c.pagingOptions.currentPage,c.repairOrderFilterOptions.filterText))}),c.repairOrderFilterOptions={filterText:"",useExternalFilter:!1},c.repairOrderTotalServerItems=0,c.pagingOptions={pageSizes:[5,10,25,50],pageSize:5,currentPage:1},c.setPagingData=function(a,b,d){var f=e?a.slice((b-1)*d,b*d):a;c.repairOrdersData=f,c.repairOrderTotalServerItems=a.length},c.getPagedDataAsync=function(a,f){c.isRODataNotNull=c.isROMsgShow=!1,e?b.repairOrder(e).then(function(b){0!==b.length?(c.isRODataNotNull=!0,c.isROMsgShow=!1,c.setPagingData(b,f,a)):(c.isRODataNotNull=!1,c.isROMsgShow=!0)}):d&&b.customerVehiclesRO(d).then(function(b){0!==b.length?(c.isRODataNotNull=!0,c.isROMsgShow=!1,c.setPagingData(b,f,a)):(c.isRODataNotNull=!1,c.isROMsgShow=!0)})},c.fnSetWatchOnGrid=function(a){a&&(c.$watch("pagingOptions",function(a,b){a!==b&&(a.currentPage===b.currentPage&&1!==b.currentPage?c.pagingOptions.currentPage=1:c.getPagedDataAsync(c.pagingOptions.pageSize,c.pagingOptions.currentPage,c.repairOrderFilterOptions.filterText))},!0),c.$watch("filterOptions",function(a,b){a!==b&&c.getPagedDataAsync(c.pagingOptions.pageSize,c.pagingOptions.currentPage,c.repairOrderFilterOptions.filterText)},!0))},c.fnSetGridOptions=function(a){c.roAction='<div class="ui-grid-cell-contents">   <md-button class="md-icon-button md-accent"                style="margin-left: 0;"               ng-click="grid.appScope.fnViewRODetails($event,row);">       <md-icon md-font-set="fa fa-lg fa-fw fa-external-link"></md-icon>       <md-tooltip ng-if="$root.isMobile == null" md-direction="top">View</md-tooltip>   </md-button></div>';var b=[],d=50;a?b=[{name:"action",displayName:"",cellTemplate:c.roAction,minWidth:50,groupable:!1,sortable:!1},{field:"closed",displayName:"Closed",cellFilter:"date:'MM/dd/yyyy h:mm a'",minWidth:200,groupable:!1},{field:"inspection",displayName:"Inspection",cellFilter:"inspection",minWidth:110,groupable:!1},{field:"order_number",displayName:"RO #",minWidth:100,groupable:!1},{field:"customer.last_name",displayName:"Customer",minWidth:180,groupable:!1},{field:"customer.phone_numbers",displayName:"Phone",cellFilter:"joinTelArray",minWidth:200,groupable:!1},{field:"customer.email_addresses",displayName:"Email",cellFilter:"joinArray",minWidth:200,groupable:!1},{field:"customer.postal_code",displayName:"Postal Code",minWidth:120,groupable:!1},{field:"vehicle.year",displayName:"Year",minWidth:80,groupable:!1},{field:"vehicle.make",displayName:"Make",minWidth:100,groupable:!1},{field:"vehicle.model",displayName:"Model",minWidth:100,groupable:!1},{field:"total_sold_price_cents",displayName:"Total RO $",cellFilter:"CentToDollar",minWidth:100,groupable:!1},{field:"labor",displayName:"Sold",cellFilter:'sumOfValue:"sold_seconds" | toHHMMSS',visible:!1,minWidth:100,groupable:!1},{field:"labor",displayName:"Actual",cellFilter:'sumOfValue:"actual_seconds" | toHHMMSS',visible:!1,minWidth:100,groupable:!1}]:(d=80,c.laborTmpl='<div class="highLight ui-grid-cell-contents overflow-auto" layout="column" layout-fill add-description arr="row.entity.labor"></div>',c.partsTmpl='<div class="highLight ui-grid-cell-contents overflow-auto" layout="column" layout-fill add-description arr="row.entity.parts"></div>',b=[{name:"action",displayName:"",cellTemplate:c.roAction,minWidth:50,enableColumnMenu:!1},{field:"closed",displayName:"Closed",cellFilter:"date:'MM/dd/yyyy h:mm a'",minWidth:200},{field:"inspection",displayName:"Inspection",cellFilter:"inspection",minWidth:110},{field:"order_number",displayName:"RO #",minWidth:100},{name:"labor",cellTemplate:c.laborTmpl,displayName:"Labor",minWidth:400},{name:"parts",cellTemplate:c.partsTmpl,displayName:"Parts",minWidth:400},{field:"total_sold_price_cents",displayName:"Total RO $",minWidth:100},{field:"labor",displayName:"Sold",cellFilter:'sumOfValue:"sold_seconds" | toHHMMSS',visible:!1,minWidth:100},{field:"labor",displayName:"Actual",cellFilter:'sumOfValue:"actual_seconds" | toHHMMSS',visible:!1,minWidth:100}]),c.repairOrderGridOptions={data:"repairOrdersData",rowHeight:d,enableRowSelection:!0,enableRowHeaderSelection:!1,enableVerticalScrollbar:0,multiSelect:!1,enableSorting:!1,enableGridMenu:!0,columnDefs:b,onRegisterApi:function(a){a.selection.on.rowSelectionChanged(c,function(a){a.isSelected=!0})}}},c.fnViewRODetails=function(a,b){c.intGridIndex=b.rowIndex,c.fnOpenRepairOrderModal(a,b.entity)},c.fnOpenRepairOrderModal=function(b,d){a.show({controller:"repairOrderModalCtrl",templateUrl:"views/authenticated/locations/modals/roDetailsDialog.html",targetEvent:b,resolve:{repairOrder:function(){return d},repairOrders:function(){return c.repairOrdersData}}})}}}}]),app.directive("addDescription",function(){return{restrict:"A",scope:{arr:"="},link:function(a,b){var c="";angular.forEach(a.arr,function(a){c+='<div style="white-space: normal; line-height: normal;" layout-margin>'+a.description+"</div>"}),b.append(c)}}}),app.filter("CentToDollar",function(){return function(a){return(a/100).toFixed(2)}}),app.filter("joinArray",function(){return function(a){return a?a.join(", "):""}}),app.filter("joinArrayOfObj",function(){return function(a){var b=[];return angular.forEach(a,function(a){b.push(a.name)}),b.join(", ")}}),app.filter("inspection",function(){return function(a){return"undefined"==typeof a||null===a||""===a?"NO":"YES"}}),app.filter("tel",function(){return function(a){if(!a)return"";var b=a.toString().trim().replace(/^\+/,"");if(b.match(/[^0-9]/))return a;var c,d,e;switch(b.length){case 10:c=1,d=b.slice(0,3),e=b.slice(3);break;case 11:c=b[0],d=b.slice(1,4),e=b.slice(4);break;case 12:c=b.slice(0,3),d=b.slice(3,5),e=b.slice(5);break;default:return a}return 1===c&&(c=""),e=e.slice(0,3)+"-"+e.slice(3),(c+" ("+d+") "+e).trim()}}),app.filter("joinTelArray",["$filter",function(a){return function(b){return"string"==typeof b?b:(angular.forEach(b,function(c,d){b[d]=a("tel")(c)}),b.join(", "))}}]),app.filter("sumOfValue",function(){return function(a,b){if("undefined"==typeof a&&"undefined"==typeof b)return 0;for(var c=0,d=0;d<a.length;d++)c+=a[d][b];return c}}),app.filter("toHHMMSS",function(){return function(a){var b=parseInt(a,10),c=Math.floor(b/3600),d=Math.floor((b-3600*c)/60),e=b-3600*c-60*d;return 10>c&&(c="0"+c),10>d&&(d="0"+d),10>e&&(e="0"+e),c+":"+d+":"+e}}),app.filter("hour",function(){return function(a){return(a/3600).toFixed(2)}}),app.filter("multiplyBy100",function(){return function(a){return(100*a).toFixed(2)}}),app.filter("calEffectiveRate",function(){return function(a){return(3600*a/100).toFixed(2)}}),app.filter("toFloor",function(){return function(a){return Math.floor(a)}}),app.factory("ErrorMsg",["$state","toastr","$cookies","cookieName",function(a,b,c,d){function e(){CarglyPartner.logout(function(){c.remove(d),a.go("login")},function(){})}var f={};return f.CheckStatusCode=function(a){switch(a){case 401:b.remove(),b.error("Access is denied due to invalid credentials.","401 - Unauthorized"),e();break;case 403:b.remove(),b.error("Do not have permission.","403 - Forbidden"),e();break;case 500:b.remove(),b.error("An unexpected error has occurred. Please refresh the page and try again.","STATUS CODE: 500");break;case 409:b.remove(),b.error("The email address provided is already associated with another partner account.","409 - Conflict")}},f}]),app.factory("encodeParamService",function(){var a={};return a.getEncodedParams=function(a){var b=[];for(var c in a)"undefined"!=typeof a[c]&&null!==a[c]&&""!==a[c]&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return 0==b.length?b.join("&"):"?"+b.join("&")},a}),app.factory("dashboardService",["$q","ErrorMsg","encodeParamService",function(a,b,c){var d={};return d.fetchDailySummary=function(d,e,f){var g=a.defer(),h={};return h.location_id=e,h.year=f,CarglyPartner.ajax({url:"/partners/api/"+d+"/reports/daily_summary"+c.getEncodedParams(h),type:"GET",success:function(a){g.resolve(a)},error:function(a){b.CheckStatusCode(a.status),g.resolve(a)}}),g.promise},d.fetchDailySummarySpecificDate=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/reports/daily_summary/"+d,type:"GET",success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},d.fetchMonthlyData=function(c,d,e){var f=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/reports/monthly/"+e+"/details"+(d?"?location_id="+d:""),type:"GET",success:function(a){f.resolve(a)},error:function(a){b.CheckStatusCode(a.status),f.resolve(a)}}),f.promise},d.fetchMonthlySummary=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/reports/monthly_summary"+(d?"?location_id="+d:""),type:"GET",success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},d.fetchMonthlySummaryWithDate=function(c,d,e){var f=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/reports/monthly_summary?from="+d+"&to="+e,type:"GET",success:function(a){f.resolve(a)},error:function(a){b.CheckStatusCode(a.status),f.resolve(a)}}),f.promise},d.fetchMonthToDate=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/reports/monthly_summary?from="+d,type:"GET",success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},d.fetchMonthlySummaryWithDateAndLoc=function(c,d,e,f){var g=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/reports/monthly_summary"+(d?"?location_id="+d+"&":"?")+"from="+e+"&to="+f,type:"GET",success:function(a){g.resolve(a)},error:function(a){b.CheckStatusCode(a.status),g.resolve(a)}}),g.promise},d.fetchRepairOrderWithDate=function(c,d,e){var f=a.defer();return CarglyPartner.ajax({url:"/partners/api/locations/"+c+"/repair-orders"+(d?"?startDate="+d+"&":"")+(e?"endDate="+e:""),type:"GET",success:function(a){f.resolve(a)},error:function(a){b.CheckStatusCode(a.status),f.resolve(a)}}),f.promise},d.fetchTopCustomers=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/reports/top_customers"+(d?"?location_id="+d:""),type:"GET",success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},d.fetchCustomerReport=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/reports/customers_by_month"+(d?"?location_id="+d:""),type:"GET",success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},d.fetchWriterStatsByMonth=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/reports/writer_stats_by_month"+(d?"?location_id="+d:""),type:"GET",success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},d.fetchTechStatsByMonth=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/reports/tech_stats_by_month"+(d?"?location_id="+d:""),type:"GET",success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},d.fetchMarketingSourceByMonth=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/reports/marketing_sources_by_month"+(d?"?location_id="+d:""),type:"GET",success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},d}]),app.factory("locationService",["$q","ErrorMsg",function(a,b){var c={};c.fetchLocation=function(){var c=a.defer();return CarglyPartner.ajax({url:"/partners/api/locations",type:"GET",success:function(a){c.resolve(a)},error:function(a){b.CheckStatusCode(a.status),c.resolve(a)}}),c.promise},c.deleteLocation=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/locations/"+c,type:"DELETE",data:null,success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.saveLocation=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/locations"+(c?"/"+c:""),type:"POST",data:d,success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},c.repairOrder=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/locations/"+c+"/repair-orders",type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.reject(a)}}),d.promise},c.recommendedService=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/locations/"+c+"/recommended",type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.reject(a)}}),d.promise};var d={};return c.setLocationObj=function(a){d=a},c.getLocationObj=function(){return d},c}]),app.factory("accountServices",["$q","ErrorMsg",function(a,b){var c={};return c.fetchAccount=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/account/"+c,type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.updateAccount=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/account"+(c?"/"+c:""),type:"POST",data:d,success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},c}]),app.factory("userService",["$q","ErrorMsg",function(a,b){var c={};c.fetchUsers=function(){var c=a.defer();return CarglyPartner.ajax({url:"/partners/api/users",type:"GET",success:function(a){c.resolve(a)},error:function(a){b.CheckStatusCode(a.status),c.resolve(a)}}),c.promise},c.deleteUser=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/users/"+c,type:"DELETE",data:null,success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.saveUser=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/users"+(c?"/"+c:""),type:"POST",data:d,success:function(a,b){var c={};c.data=a,c.status=b,e.resolve(c)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise};var d={};return c.setUserObj=function(a){d=a},c.getUserObj=function(){return d},c}]),app.factory("billingHistoryService",["$q","ErrorMsg",function(a,b){var c={};return c.fetchBillingHistory=function(){var c=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+CarglyPartner.user.partnerId+"/payments",type:"GET",success:function(a){c.resolve(a)},error:function(a){b.CheckStatusCode(a.status),c.resolve(a)}}),c.promise},c}]),app.factory("paymentService",["$q","ErrorMsg",function(a,b){var c={};return c.fetchUserPaymentInfo=function(){var c=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+CarglyPartner.user.partnerId+"/payment-info",type:"GET",success:function(a){c.resolve(a)},error:function(a){b.CheckStatusCode(a.status),c.resolve(a)}}),c.promise},c.savePaymentInfo=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+CarglyPartner.user.partnerId+"/payment-info",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(c),success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.fetchPayment=function(){var c=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+CarglyPartner.user.partnerId+"/payments",type:"GET",success:function(a){c.resolve(a)},error:function(a){b.CheckStatusCode(a.status),c.resolve(a)}}),c.promise},c.savePayment=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+CarglyPartner.user.partnerId+"/payments",type:"POST",data:c,success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c}]),app.factory("AuthService",["$q","$state","$location","$cookies","paymentService","cookieName","ErrorMsg",function(a,b,c,d,e,f,g){function h(a,b){var c=!0;if(null!==a.subscriptions&&""!==a.subscriptions){var d=JSON.parse(a.subscriptions);angular.forEach(d,function(a){c&&-1===a.subscriptions.indexOf(b)&&(c=!1)})}else c=!1;return c}function i(a,d){""===b.current.name?(c.url(a),d.resolve()):d.reject()}var j={};return j.fnGetUser=function(e){var j=d.get(f),k=a.defer();return angular.isUndefined(j)?null!=CarglyPartner.queryParams&&null!=CarglyPartner.queryParams.resetpw&&""!=CarglyPartner.queryParams.resetpw?i("/reset-password",k):i("/login",k):CarglyPartner._getUser(j,function(a){"true"===a.verified?angular.isUndefined(e)?"/verify"===c.path()||"/payment"===c.path()?h(a,e)?k.resolve(a):i("/locations",k):k.resolve(a):h(a,e)?k.resolve(a):i("/locations",k):"/verify"===c.path()&&"login"===b.current.name?k.resolve(a):i("/verify",k)},function(a){a&&g.CheckStatusCode(a.status)}),k.promise},j.fnAuthTokenUndefined=function(){var b=d.get(f),c=a.defer();return angular.isUndefined(b)?null!=CarglyPartner.queryParams&&null!=CarglyPartner.queryParams.resetpw&&""!=CarglyPartner.queryParams.resetpw?i("/reset-password",c):c.resolve():i("/dashboard",c),c.promise},j.fnResetPWTokenVerified=function(){var b=a.defer();return null!=CarglyPartner.queryParams&&null!=CarglyPartner.queryParams.resetpw&&""!=CarglyPartner.queryParams.resetpw?b.resolve():i("/login",b),b.promise},j}]),app.factory("crmInteractionService",["$q","encodeParamService","ErrorMsg",function(a,b,c){var d={};d.fetchShopLocationSegments=function(b){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/crm/"+b+"/segments",type:"GET",success:function(a){d.resolve(a)},error:function(a){c.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},d.fetchCrmInteraction=function(d,e){var f=a.defer();return CarglyPartner.ajax({url:"/partners/api/crm/"+d.locationId+"/segments/"+d.segmentId+"/interactions"+b.getEncodedParams(e),type:"GET",success:function(a){f.resolve(a)},error:function(a){c.CheckStatusCode(a.status),f.reject(a)}}),f.promise},d.saveCrmInteraction=function(b,d,e){var f=a.defer();return CarglyPartner.ajax({url:"/partners/api/crm/"+b+"/interactions/"+d,type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(e),success:function(a){f.resolve(a)},error:function(a){c.CheckStatusCode(a.status),f.resolve(a)}}),f.promise};var e={};return d.setShopLocSegmentObj=function(a){e=a},d.getShopLocSegmentObj=function(){return e},d}]),app.factory("allCustomerService",["$q","ErrorMsg",function(a,b){var c={},d="";c.fetchShopLocations=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/agent/client-locations"+(c?"?group_id="+c:""),type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.filterShopLocationsData=function(c){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/agent/client-locations?filter="+(c?c:""),type:"GET",success:function(a,b,c){d=c["x-paging-cursor"];var f={};f.data=a,f.status=b,f.headers=c,e.resolve(f)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},c.saveShopLocations=function(c,d){var e=a.defer();return 0===c.length&&(c=null),CarglyPartner.ajax({url:"/partners/api/agent/client-locations"+(c?"/"+c:""),type:"POST",data:d,success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},c.fetchShopLocationEvents=function(c,d){var e=a.defer();return 0===c.length&&(c=null),CarglyPartner.ajax({url:"/partners/api/locations/"+c+"/events",type:"GET",data:"pageNum="+d,success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},c.updateShopLocationNextConfig=function(c,d){var e=a.defer();return 0===c.length&&(c=null),CarglyPartner.ajax({url:"/partners/api/agent/client-locations/"+c+"/next-config",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(d),success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},c.sendDailyEmail=function(c){var d=a.defer();return 0===c.length&&(c=null),CarglyPartner.ajax({url:"/partners/api/locations/"+c+"/email-reports/daily-email/send",type:"GET",data:null,success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.recommendedService=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/locations/"+c+"/recommended",type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.repairOrder=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/locations/"+c+"/repair-orders",type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.fetchLog=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/locations/"+c+"/logs",type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.fetchNextConfig=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/agent/client-locations/"+c+"/next-config",type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.saveNextConfig=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/agent/client-locations/"+c+"/next-config",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(d),success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},c.customersData=function(c,d){var e=a.defer();return CarglyPartner.ajax({url:"/partners/api/locations/"+c+"/customers2"+(d?"?filter="+d:""),type:"GET",success:function(a){e.resolve(a)},error:function(a){b.CheckStatusCode(a.status),e.resolve(a)}}),e.promise},c.customerVehiclesRO=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/vehicles/"+c+"/repair-orders",type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.customerVehiclesRS=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/vehicles/"+c+"/recommended",type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.fetchMoreShopLocations=function(){var c=a.defer();return CarglyPartner.ajax({url:"/partners/api/agent/client-locations"+(d?"?cursor="+d:""),type:"GET",success:function(a,b,e){
d=e["x-paging-cursor"];var f={};f.data=a,f.status=b,f.headers=e,c.resolve(f)},error:function(a){b.CheckStatusCode(a.status),c.resolve(a)}}),c.promise};var e={};c.setShopLocationsObj=function(a){e=a},c.getShopLocationsObj=function(){return e};var f={};return c.setVehicleObj=function(a){f=a},c.getVehicleObj=function(){return f},c}]),app.factory("crmTemplateService",["$q","ErrorMsg",function(a,b){var c={};return c.fetchClientTemplates=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/"+c+"/email-templates",type:"GET",success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.resolve(a)}}),d.promise},c.interpolateClientTemplate=function(c){var d=a.defer();return CarglyPartner.ajax({url:"/partners/api/interpolate",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(c),success:function(a){d.resolve(a)},error:function(a){b.CheckStatusCode(a.status),d.reject(a)}}),d.promise},c}]),app.factory("Toast",["$mdToast",function(a){var b={};return b.success=function(b){a.show({template:'<md-toast class="tr-toast-msg-success"><span flex>'+b+"</span></md-toast>",hideDelay:2e3,position:"top right"})},b.failure=function(b){a.show({template:'<md-toast class="tr-toast-msg-error"><span flex>'+b+"</span></md-toast>",hideDelay:2e3,position:"top right"})},b}]),app.controller("HeaderCtrl",["$scope","$mdDialog",function(a,b){a.showSignup=function(a){b.show({controller:"SignUpCtrl",templateUrl:"views/modals/signup.html",targetEvent:a})}}]),app.controller("LoginCtrl",["$scope","$rootScope","$mdDialog","$mdMedia","$location","paymentService","toastr","ErrorMsg",function(a,b,c,d,e,f,g,h){a.user={isProcessing:!1},a.fnRefreshDom=function(){a.$$phase||a.$apply()},a.fnSignInUser=function(b){b.isProcessing=!0,CarglyPartner.login(b.email,b.password,function(c){if(b.isProcessing=!1,a.fnRefreshDom(),g.success("Signed in as "+c.name),"true"===c.verified)if(null!==c.subscriptions&&""!==c.subscriptions){var d=JSON.parse(c.subscriptions);angular.forEach(d,function(a){-1!==a.subscriptions.indexOf("realtime_dashboard")?e.url("/dashboard"):e.url("/locations")})}else e.url("/locations");else e.url("/verify")},function(c){b.isProcessing=!1,a.fnRefreshDom(),c&&401!==c.status?h.CheckStatusCode(c.status):g.error("Username and password are wrong.")})},a.fnForgotPassword=function(a){c.show({controller:"ForgotPasswordCtrl",templateUrl:"views/modals/forgotPassword.html",targetEvent:a,clickOutsideToClose:!0})}}]),app.controller("ResetPasswordCtrl",["$scope","$location","toastr",function(a,b,c){a.pass={isProcessing:!1},a.fnResetPassword=function(a){if(a.password!==a.retypePassword)c.error("Password must be matched.");else{a.isProcessing=!0;var d=angular.copy(a);delete d.isProcessing,CarglyPartner.resetPassword(d.password,function(){a.isProcessing=!1,c.success("Password changed successfully."),b.url("/login")},function(){a.isProcessing=!1,c.error("Something goe's wrong, while resetting password.")})}}}]),app.controller("SignUpCtrl",["$scope","$location","$timeout","$mdDialog","globalTimeZone","ErrorMsg","toastr",function(a,b,c,d,e,f,g){a.user={businessTimezone:"US/Central",isProcessing:!1},a.timeZoneDDOptions=e,a.fnHide=function(){d.hide()},a.fnCancel=function(){d.cancel()},a.fnRefreshDom=function(){c(function(){a.$apply()})},a.fnRegisterUser=function(c){c.password!==c.confirmPassword?g.error("Password must be matched"):(a.isProcessing=!0,CarglyPartner.createPartner(c,function(){a.isProcessing=!1,a.fnRefreshDom(),a.fnHide(),b.url("/verify")},function(b){a.isProcessing=!1,a.fnRefreshDom(),"undefined"==typeof b||409!==b.status?(g.remove(),g.error("An unexpected error occurred on the server. Please reload the page and try again. If the problem continues, contact us at support@cargly.com.")):f.CheckStatusCode(b.status)}))},a.fnOpenTermsOfServiceModal=function(a){var b=["$scope","$mdDialog",function(b,c){b.hide=function(){c.hide(),b.fnOpenSignUp()},b.fnOpenSignUp=function(){c.show({controller:"SignUpCtrl",templateUrl:"views/modals/signup.html",targetEvent:a})}}];d.show({controller:b,templateUrl:"views/modals/termsOfServiceDialog.html",targetEvent:a})}}]),app.controller("ForgotPasswordCtrl",["$scope","$mdDialog","toastr",function(a,b,c){a.resendEmail="",a.fnHide=function(){b.hide()},a.fnCancel=function(){b.cancel()},a.fnResendMail=function(b){CarglyPartner.requestPasswordReset(b,function(){c.success("Password request send successfully."),a.fnHide()},function(){c.error("Something goe's wrong while sending request."),a.fnHide()})}}]),app.controller("MainCtrl",["$scope","$mdDialog","$location","$cookies","cookieName","$state","$mdSidenav",function(a,b,c,d,e,f,g){a.fnToggleSideNav=function(a){g(a).toggle().then(function(){if(g(a).isOpen()){var b=$(".left-side-nav").parent().find("md-backdrop").first();$(b).css("z-index","61")}})},a.fnIsActive=function(a){return a===c.path()?"md-accent":""},a.fnLogout=function(){CarglyPartner.logout(function(){d.remove(e),f.go("login")},function(){})},a.fnStateSettings=function(){f.go("main.settings",{settingsName:"account"})},a.fnInitMain=function(){CarglyPartner.user&&(a.userObj=CarglyPartner.user,a.userSubscriptions=JSON.parse(CarglyPartner.user.subscriptions))},a.fnCheckSubscription=function(a,b){var c=!0;return null!==a&&""!==a?angular.forEach(a,function(a){c&&-1===a.subscriptions.indexOf(b)&&(c=!1)}):c=!1,c},a.fnOpenTermsOfServiceModal=function(a){var c=["$scope","$mdDialog",function(a,b){a.hide=function(){b.hide()},a.cancel=function(){b.cancel()}}];b.show({controller:c,templateUrl:"views/modals/termsOfServiceDialog.html",targetEvent:a})}}]),app.controller("VerifyCtrl",["$scope","$cookies","$state","$timeout","$mdDialog","cookieName","toastr",function(a,b,c,d,e,f,g){a.isProcessing=!1,a.fnLogout=function(){CarglyPartner.logout(function(){b.remove(f),c.go("login")},function(){})},a.fnOpenTermsOfServiceModal=function(a){var b=["$scope","$mdDialog",function(a,b){a.hide=function(){b.hide()},a.cancel=function(){b.cancel()}}];e.show({controller:b,templateUrl:"views/modals/termsOfServiceDialog.html",targetEvent:a})},a.fnRefreshDom=function(){d(function(){a.$apply()})},a.fnReconfirmUser=function(){a.isProcessing=!0,CarglyPartner.reconfirmUser(function(){a.isProcessing=!1,a.fnRefreshDom(),g.success("Confirmation email sent successfully.")})},a.fnInitVerify=function(){CarglyPartner.user&&(a.userObj=CarglyPartner.user)}}]),app.controller("PaymentCtrl",["$scope","$cookies","$state","$mdDialog","cookieName","paymentService",function(a,b,c,d,e,f){function g(a){f.savePaymentInfo(a).then(function(){c.go("main.dashboard")})}a.fnLogout=function(){CarglyPartner.logout(function(){b.remove(e),c.go("login")},function(){})},a.fnOpenTermsOfServiceModal=function(a){var b=["$scope","$mdDialog",function(a,b){a.hide=function(){b.hide()},a.cancel=function(){b.cancel()}}];d.show({controller:b,templateUrl:"views/modals/termsOfServiceDialog.html",targetEvent:a})},a.payment={isProcessing:!1},ChargeIO.init({public_key:"m_zuT9A5oAQTilLxkc_PWanQ"}),a.fnUpdateUserPaymentInfo=function(a){a.isProcessing=!0;var b=angular.copy(a);delete b.isProcessing,ChargeIO.create_token(b,g,function(b){a.isProcessing=!1,console.log(b.error.message)})},a.fnInitPaymentInfo=function(){CarglyPartner.user&&(a.userObj=CarglyPartner.user)}}]),app.controller("DashboardCtrl",["$scope","$rootScope","$mdDialog","$filter","$timeout","$location","toastr","accountServices","locationService","dashboardService",function(a,b,c,d,e,f,g,h,i,j){function k(b,c,d,e){var f=isNaN(c)||0===c?0:(b-c)/c;f=parseInt(100*f.toFixed(2));var g={};g.value=(0>f?f:"+"+f)+"%",g.colorCode=0>f?"#ff0000":"#008000";var h={};h[d]=g,angular.extend(x,h),a.varianceObj[e]=angular.copy(x)}function l(){1===y?a.isSummary2015Data=!0:++y}function m(b){var c=b.new_customers;c=0>c?0:c;var d=b.active_customers,e=d-c;e=0>e?0:e;var f=b.lost_customers;return f=0>f?0:f,0===c&&0===e&&0===f?void(a.isPieChartDataMsg=!0):(a.createPieChartJson={"Newly Active":c,"Other Active":e,Lost:f},a.isPieChartCustData=!0,a.isPieChartDataMsg=!1,void a.fnGeneratePieChart(b))}function n(){z={isDailyBarVisited:!1,isEmployeeBarVisited:!1,isCustomerBarVisited:!1,isMarketingBarVisited:!1}}function o(){z.isDailyBarVisited||withinviewport($("#dashboard-tab section#daily-barchart-section div.roContainer"))&&(console.log("Daily-Barchart-Section: Call for /repair-order API"),z.isDailyBarVisited=!0,a.fnRepairOrders(a.selectedLocationOption,u,v)),z.isEmployeeBarVisited||withinviewport($("#dashboard-tab section#employee-barchart-section"))&&(console.log("Employee-Barchart-Section: Call for /reports/writer_stats_by_month and /reports/tech_stats_by_month API"),z.isEmployeeBarVisited=!0,a.fnFetchWriterStatsByMonth(a.selectedLocationOption)),z.isCustomerBarVisited||withinviewport($("#dashboard-tab section#customer-barchart-section div.custBarContainer"))&&(console.log("Customer-Barchart-Section: Call for /reports/customers_by_month API"),z.isCustomerBarVisited=!0,a.fnFetchCustomerReport(a.selectedLocationOption)),z.isMarketingBarVisited||withinviewport($("#dashboard-tab section#marketing-barchart-section"))&&(console.log("Marketing-Barchart-Section: Call for /reports/marketing_sources_by_month API"),z.isMarketingBarVisited=!0,a.fnFetchMarketingSourceByMonth(a.selectedLocationOption))}a.partnerId="",a.locationDDOptions=[],a.selectedLocationOption="",a.isSetupModalShow=!0,a.isDailySummaryData=!1,a.currentYearData=a.priorYearData=a.last_12_months=a.last_30_days={},a.summaryDDOptions=[],a.selectedSummaryOption="",a.curr_summary_2015=a.prior_summary_2015=a.dec_summary_2015={},a.isSummary2015Data=!1,a.empPerformanceDDOptions=[],a.selectedEmpPerformanceOption="",a.createEmpPerformanceJSON={},a.isEmpPerformanceDataLoaded=!1,a.isEmpPerformanceMsg=!1,a.createMarketingSourceArr=[],a.isMarketingSourcesDataLoaded=!1,a.isMarketingSourcesMsg=!1,a.custRepoOptions=[],a.selectedCustRepoOptions="";var p=["Jan","Feb","March","April","May","June","July","Aug","Sept","Oct","Nov","Dec"],q=["January","February","March","April","May","June","July","August","September","October","November","December"];a.getLast12Month=[];var r=(new Date).getDate(),s=(new Date).getMonth()+1,t=(new Date).getFullYear();a.fnCheckEventStartDate=function(a,b,c){var d="";return d=new Date(a,b,0).getDate()===c?12===b?a+1+"-01-01T05:00:00.000Z":a+"-"+(b+1)+"-01T05:00:00.000Z":a+"-"+b+"-"+(c+1)+"T05:00:00.000Z"};var u=a.fnCheckEventStartDate(t,s,r),v=t+"-"+s+"-"+r+"T05:00:00.000Z";a.createJSON={},a.createPieChartJson={};var w=["gross_sales_cents","average_daily_sales_gross_cents","average_sale_cents","average_daily_sales_count"];a.varianceObj=[];var x={};a.isMonthlySummaryData=!1,a.monthToDate={},a.fnFetchAgentAppDownloadUrl=function(){h.fetchAccount(CarglyPartner.user.id).then(function(b){a.appDownloadUrl=b.appDownloadUrl,a.fnGetLocationDetails()})},a.fnGetLocationDetails=function(){a.locationDDOptions=[],i.fetchLocation().then(function(b){a.fnCreateLocationDD(b),a.fnLocationStatus(b)},function(a){g.error("Retrieving locations failed.","STATUS CODE: "+a.status)})},a.fnCreateLocationDD=function(b){angular.forEach(b,function(b){a.locationDDOptions.push({id:b.id,name:b.name,value:b.id})}),a.locationDDOptions.unshift({id:"",name:"All locations"}),a.selectedLocationOption=a.locationDDOptions[1].value,a.fnLocationChange(a.selectedLocationOption)},a.fnLocationChange=function(b){a.currentDate=moment().toDate(),console.log("Summary-Section: Call for /reports/daily_summary API"),a.fnGetDailySummary(b),console.log("Monthly-Barchart-section: Call for /reports/monthly_summary API"),a.fnGetMonthlySummaryWithDateAndLocation(b),n(),o()},a.fnLocationStatus=function(d){if(0===d.length){var e=c.confirm().title("Create Location").content("No locations exist. Please create location.").ariaLabel("createLocation").ok("Create").cancel("Cancel");c.show(e).then(function(){f.url("/locations"),b.isOpenNewLocation=!0},function(){})}else 0!==d.length?(a.isLocationStatusData=!0,a.locations=d,angular.forEach(a.locations,function(b){a.fnLastSyncIsNull(b)})):a.isLocationStatusData=!1},a.fnLastSyncIsNull=function(b,c){b.lastConfig="string"==typeof b.lastConfig?JSON.parse(b.lastConfig):b.lastConfig,null!==b.lastConfig?b.lastConfig.settings&&null===b.lastConfig.settings["carglyconnect.lastsync"]&&a.isSetupModalShow&&(a.fnCustomDialog(c),a.isSetupModalShow=!1):a.isSetupModalShow&&(a.fnCustomDialog(c),a.isSetupModalShow=!1)},a.fnCustomDialog=function(b){var d=["$scope","$mdDialog",function(a,b){a.fnHide=function(){b.hide()},a.fnGoTo=function(){a.fnHide(),f.url("/location/setup")}}];c.show({controller:d,template:'<md-dialog id="download-app" aria-label="downloadApp">   <md-toolbar class="md-primary">       <div class="md-toolbar-tools">Location Setup</div>   </md-toolbar>   <md-dialog-content class="md-padding">       The location has never communicated. Please download location setup here. <br/>       <a href="'+a.appDownloadUrl+'" target="_blank">Click to download setup</a>.   </md-dialog-content>   <md-dialog-actions>       <md-button class="md-raised" ng-click="fnHide()">Cancel</md-button>       <md-button class="md-raised md-accent" ng-click="fnGoTo()">Location Setup</md-button>   </md-dialog-actions></md-dialog>'}).then(function(){},function(){})},a.fnCalculateGrossProfitCent=function(a){var b=0;return b=a.total_labor_profit_cents+a.total_parts_profit_cents+a.total_sublet_profit_cents-a.total_discount_cents},a.fnCalcOverPrevYear=function(b,c,d){var e,f;e=f=0,angular.forEach(w,function(a){e=b[a]/100,f=c[a]/100,k(e,f,a,d)}),e=a.fnCalculateGrossProfitCent(b),f=a.fnCalculateGrossProfitCent(c),k(e/100,f/100,"gross_profit_dollar",d),e=0==b.gross_sales_cents?0:e/b.gross_sales_cents*100,f=0==c.gross_sales_cents?0:f/c.gross_sales_cents*100,k(e,f,"gross_profit_per",d)};var y=0;a.fnSummaryOptionChanged=function(b,c){if("2015"===b){y=0,a.isSummary2015Data=!1,j.fetchDailySummary(a.partnerId,c,b).then(function(b){a.curr_summary_2015=b.current_year,a.prior_summary_2015=b.prior_year,a.fnCalcOverPrevYear(a.curr_summary_2015,a.prior_summary_2015,1),l()});var d="2015-12-01",e="2015-12-31";j.fetchMonthlySummaryWithDateAndLoc(a.partnerId,c,d,e).then(function(b){a.dec_summary_2015=b.summaries.pop(),l()})}},a.fnCreateSummaryDD=function(){a.summaryDDOptions=[{name:"Year-to-date/Month-to-date",value:"year_month_to_date"},{name:"Last 12 months/Last 30 days",value:"last_12_months_30_days"},{name:"2015",value:"2015"}]},a.fnGetDailySummary=function(b){a.isDailySummaryData=!1,j.fetchDailySummary(a.partnerId,b).then(function(b){a.currentYearData=b.current_year,a.priorYearData=b.prior_year,a.last_12_months=b.last_12_months,a.last_30_days=b.last_30_days,a.fnCreateSummaryDD(),a.fnCalcOverPrevYear(a.currentYearData,a.priorYearData,0),a.isDailySummaryData=!0},function(a){g.error("Retrieving daily summary failed.","STATUS CODE: "+a.status)})},a.fnGetMonthlySummaryWithDateAndLocation=function(b){a.isMonthlySummaryData=!1;var c=moment().subtract(2,"year").add(1,"months").subtract(1,"day").format("YYYY-MM-DD"),d=moment().daysInMonth();d=moment().date(d).format("YYYY-MM-DD"),j.fetchMonthlySummaryWithDateAndLoc(a.partnerId,b,c,d).then(function(b){a.fnCreatechartGroupsDD(),a.isMonthlySummaryData=!0;var c=angular.copy(b.summaries);a.monthlySummary=b.summaries,a.fnCreateJSON(a.monthlySummary),a.monthToDate=c.pop()},function(a){g.error("Retrieving monthly summary failed.","STATUS CODE: "+a.status)})},a.fnRepairOrders=function(b,c,d){a.isRepairOrdersData=!1,b?j.fetchRepairOrderWithDate(b,c,d).then(function(b){a.isRepairOrdersData=!0,a.isLocId=!0,b.length>0?(a.repairOrders=b,a.isRepairOrderMsg=!1):a.isRepairOrderMsg=!0}):(a.isLocId=!1,a.isRepairOrdersData=!0,a.isRepairOrderMsg=!1),a.fnRefreshDom()},a.fnOpenRepairOrderModal=function(a,b,d){c.show({controller:"repairOrderModalCtrl",templateUrl:"views/authenticated/dashboard/modals/roDetailsDialog.html",targetEvent:a,resolve:{repairOrder:function(){return b},repairOrders:function(){return d}}})},a.fnCreateJSON=function(b){a.createJSON={};var c=b[0],e="",f=[],g=[];for(var h in c)c.hasOwnProperty(h)&&(a.createJSON[h]=[]);a.createJSON.gross_profit_cents=[],a.createJSON.shop_efficiency=[],a.createJSON.sold_hours_per_ro=[],angular.forEach(b,function(b,h){var i=d("CentToDollar")(a.fnCalculateGrossProfitCent(b));for(var j in b)b.hasOwnProperty(j)&&("labor_sold_cents_per_second"!==j&&j.split("_").indexOf("cents")>-1&&(b[j]=d("CentToDollar")(b[j])),"rate"===j.split("_").pop()&&(b[j]=d("multiplyBy100")(b[j])),j.split("_").indexOf("seconds")>-1&&(b[j]=d("hour")(b[j])));b.labor_sold_cents_per_second&&(b.labor_sold_cents_per_second=d("calEffectiveRate")(b.labor_sold_cents_per_second));var k=0!=b.total_labor_actual_seconds?(b.total_labor_sold_seconds/b.total_labor_actual_seconds).toFixed(2):0,l=0!=b.sale_count?(b.total_labor_sold_seconds/b.sale_count).toFixed(2):0,m=p[b.month-1];if(12>h?(e="Previous 12 months",-1===g.indexOf(e)&&g.push(e)):(e="Most recent 12 months",-1===g.indexOf(e)&&g.push(e)),-1!==f.indexOf(b.month)){for(var n in c)c.hasOwnProperty(n)&&a.fnCheckMonthInObj(m,e,a.createJSON[n],b[n]);a.fnCheckMonthInObj(m,e,a.createJSON.gross_profit_cents,i),a.fnCheckMonthInObj(m,e,a.createJSON.shop_efficiency,k),a.fnCheckMonthInObj(m,e,a.createJSON.sold_hours_per_ro,l)}else{f.push(b.month);for(var o in c)c.hasOwnProperty(o)&&a.fnPushObj(m,e,a.createJSON[o],b[o]);a.fnPushObj(m,e,a.createJSON.gross_profit_cents,i),a.fnPushObj(m,e,a.createJSON.shop_efficiency,k),a.fnPushObj(m,e,a.createJSON.sold_hours_per_ro,l)}}),a.setColumnValue=g},a.fnPushObj=function(a,b,c,d){var e={};e.month=a,e[b]=d,c.push(e)},a.fnCheckMonthInObj=function(a,b,c,d){$.each(c,function(c,e){e.month===a&&(e[b]=d)})},a.chartGroupsOptions=[{name:"Key Indicators",value:"key_indicators"},{name:"Gross Sales",value:"gross_sales"},{name:"Cost of Sales",value:"cost_of_sales"},{name:"Gross Profit",value:"gross_profit"},{name:"Marketing",value:"marketing"},{name:"Repair Order Analysis",value:"repair_order_analysis"},{name:"Miscellaneous",value:"miscellaneous"}],a.fnCreatechartGroupsDD=function(){a.chartGroupsOptions=[{name:"Key Indicators",value:"key_indicators"},{name:"Gross Sales",value:"gross_sales"},{name:"Cost of Sales",value:"cost_of_sales"},{name:"Gross Profit",value:"gross_profit"},{name:"Marketing",value:"marketing"},{name:"Repair Order Analysis",value:"repair_order_analysis"},{name:"Miscellaneous",value:"miscellaneous"}]},a.selectedGroupOption=a.chartGroupsOptions[0],a.chartGroups={cost_of_sales:[{name:"Labor Cost $",value:"total_labor_cost_cents"},{name:"Parts Cost $",value:"total_parts_cost_cents"},{name:"Sublet Cost $",value:"total_sublet_cost_cents"}],gross_profit:[{name:"Gross Profit $ Total",value:"gross_profit_cents"},{name:"Labor Gross Profit $",value:"total_labor_profit_cents"},{name:"Parts Gross Profit $",value:"total_parts_profit_cents"},{name:"Sublet Gross Profit $",value:"total_sublet_profit_cents"}],gross_sales:[{name:"Discounts $",value:"total_discount_cents"},{name:"Gross Sales $ Total",value:"gross_sales_cents"},{name:"Labor Sold $",value:"total_labor_sold_cents"},{name:"Other Sold $",value:"total_other_sold_cents"},{name:"Parts Sold $",value:"total_parts_sold_cents"},{name:"Sublet Sold $",value:"total_sublet_sold_cents"}],key_indicators:[{name:"Gross Sales $ Total",value:"gross_sales_cents"},{name:"Actual Hours Total",value:"total_labor_actual_seconds"},{name:"Average RO Sales $",value:"average_sale_cents"},{name:"Daily RO Count Average",value:"average_daily_sales_count"},{name:"Daily Sales $ Average",value:"average_daily_sales_gross_cents"},{name:"Effective Labor Rate $",value:"labor_sold_cents_per_second"},{name:"Gross Profit % Total",value:"labor_and_parts_profit_rate"},{name:"Labor Gross Profit %",value:"labor_profit_rate"},{name:"Parts Gross Profit %",value:"parts_profit_rate"},{name:"RO Count",value:"sale_count"},{name:"Shop Efficiency",value:"shop_efficiency"},{name:"Sold Hours per RO",value:"sold_hours_per_ro"},{name:"Sold Hours Total",value:"total_labor_sold_seconds"},{name:"Sublet Gross Profit %",value:"sublet_profit_rate"}],marketing:[{name:"New Customers Count",value:"new_customers_count"},{name:"Returning Customers Count",value:"returning_customers_count"}],miscellaneous:[{name:"Day Count",value:"day_count"},{name:"Gross Sales $ with Taxes",value:"gross_sales_after_tax_cents"},{name:"Labor Cost $ per RO",value:"average_labor_cost_cents"},{name:"Labor Profit $ per RO",value:"average_labor_profit_cents"},{name:"Labor Sold $ After Discounts",value:"total_labor_sold_cents_after_discounts"},{name:"Parts Cost $ per RO",value:"average_parts_cost_cents"},{name:"Parts Profit $ per RO",value:"average_parts_profit_cents"},{name:"Parts Sold $ After Discounts",value:"total_parts_sold_cents_after_discounts"},{name:"Sublet Cost $ per RO",value:"average_sublet_cost_cents"},{name:"Sublet Profit $ per RO",value:"average_sublet_profit_cents"},{name:"Sublet Sold $ After discounts",value:"total_sublet_sold_cents_after_discounts"},{name:"Taxes $",value:"total_tax_paid_cents"}],repair_order_analysis:[{name:"Average RO Sales $",value:"average_sale_cents"},{name:"Discount $ per RO",value:"average_discount_cents"},{name:"Labor $ per RO",value:"average_labor_sold_cents"},{name:"Other Sales $ per RO",value:"average_other_sold_cents"},{name:"Parts $ per RO",value:"average_parts_sold_cents"},{name:"RO Count",value:"sale_count"},{name:"Sublet $ per RO",value:"average_sublet_sold_cents"}]},a.chartOptions=a.chartGroups[a.selectedGroupOption.value],a.selectedChartType=a.chartOptions[0],a.barChartName=a.selectedChartType.name,a.sendJsonToBar=a.createJSON[a.selectedChartType.value],a.fnChangeGroup=function(b){a.chartOptions=a.chartGroups[b.value],a.barChartName=a.selectedChartType.name},a.sendJsonToBar=[],a.fnGenerateBarChart=function(b,c){b&&(a.barChartName=b.name,a.sendJsonToBar=a.createJSON[b.value],a.fnGenerateMonthlyBarChart(b,c),"day_count"!==b.value&&"average_daily_sales_count"!==b.value&&"average_daily_sales_gross_cents"!==b.value&&a.fnGenerateDailyBarChart(11,"Most recent 12 months",b,c))},a.fnReturnTooltipVal=function(a,b){var c="";return c="gross_sales_cents"===a||"average_sale_cents"===a||"average_daily_sales_gross_cents"===a||"labor_sold_cents_per_second"===a||"total_labor_sold_cents"===a||"total_labor_cost_cents"===a||"total_labor_profit_cents"===a||"total_parts_sold_cents"===a||"total_parts_cost_cents"===a||"total_parts_profit_cents"===a||"total_discount_cents"===a||"average_labor_sold_cents"===a||"average_labor_cost_cents"===a||"average_labor_profit_cents"===a||"average_parts_sold_cents"===a||"average_parts_cost_cents"===a||"average_parts_profit_cents"===a||"average_discount_cents"===a||"total_labor_sold_cents_after_discounts"===a||"total_parts_sold_cents_after_discounts"===a||"total_sublet_sold_cents"===a||"total_sublet_cost_cents"===a||"total_sublet_profit_cents"===a||"average_sublet_sold_cents"===a||"average_sublet_cost_cents"===a||"average_sublet_profit_cents"===a||"total_sublet_sold_cents_after_discounts"===a||"gross_sales_after_tax_cents"===a||"total_tax_paid_cents"===a||"total_other_sold_cents"===a||"average_other_sold_cents"===a||"gross_profit_cents"===a?d("currency")(b):"labor_and_parts_profit_rate"===a||"parts_profit_rate"===a||"labor_profit_rate"===a||"sublet_profit_rate"===a?b+"%":"average_daily_sales_count"===a?d("number")(b,2):b},a.fnGenerateMonthlyBarChart=function(c,d){if(a.isMonthlySummaryData){var e=0;a.isMonthlyBarMsg=!1;c3.generate({bindto:"#bar-chart",padding:{top:40,right:50},data:{json:a.sendJsonToBar,keys:{x:"month",value:a.setColumnValue},type:"bar",colors:{"Previous 12 months":"#1F77B4","Most recent 12 months":"#FF7F0E"},color:function(a,b){return 0===b.value&&e++,a},onclick:function(e){e.name?"day_count"!==c.value&&"average_daily_sales_count"!==c.value&&"average_daily_sales_gross_cents"!==c.value&&a.fnGenerateDailyBarChart(e.index,e.name,c,d):b.isMobile&&g.info("Please put your finger on the specific target.")}},grid:{y:{show:!0}},onrendered:function(){a.isMonthlyBarMsg=a.sendJsonToBar.length+12===e,a.fnRefreshDom(),e=0},transition:{duration:1e3},bar:{width:{ratio:.5}},zoom:{enabled:!1},axis:{x:{label:{text:"Month",position:"outer-center"},type:"category",height:50,tick:{rotate:75,multiline:!1}},y:{label:{text:a.barChartName,position:"outer-middle"}}},tooltip:{grouped:!0,contents:function(b,d,e,f){var g,h,i,j,k,l,m=this,n=m.config,o=n.tooltip_format_name||function(a){return a},p=n.tooltip_format_value||e,q=!0;for(g||(g='<table class="'+m.CLASS.tooltip+'"><tr><th colspan="2">'+a.barChartName+"</th></tr>"),h=0;h<b.length;h++)b[h]&&(b[h].value||0===b[h].value)&&(j=o(b[h].name),i=p(b[h].value,b[h].ratio,b[h].id,b[h].index),k=m.levelColor?m.levelColor(b[h].value):f(b[h].id),0!==b[h].value&&(q=!1),l=a.fnReturnTooltipVal(c.value,i),g+='<tr class="'+m.CLASS.tooltipName+"-"+b[h].id+'"><td class="name"><span style="background-color:'+k+'"></span>'+j+'</td><td class="value">'+l+"</td></tr>");if(!q){if(void 0!==b[0]&&void 0!==b[1]){var r=b[0].value<b[1].value?b[1].value-b[0].value:b[0].value-b[1].value;r%1!==0&&(r=r.toFixed(2)),l=a.fnReturnTooltipVal(c.value,r),g+='<tr style="text-align: right"><td>Variance</td><td>'+l+"</td></tr>"}return g+='<tr><td colspan="2">Click a month to see daily details.</td></tr></table>'}}}})}},a.fnGenerateDailyBarChart=function(b,c,e,f,g){function h(b,c,d,e,f,g,h){var i={};"Previous 12 months"===d?i[e]="#1F77B4":"Most recent 12 months"===d&&(i[e]="#FF7F0E");var j=0;if(a.isDailyBarMsg=!1,a.isDailySummaryData){c3.generate({bindto:"#daily-bar-chart",padding:{top:40,right:50},data:{json:b,keys:{x:"day",value:[e]},type:"bar",colors:i,color:function(a,b){return 0===b.value&&j++,a},onclick:function(b){var c=a.fnCheckEventStartDate(f,g,b.index+1),d=f+"-"+g+"-"+(b.index+1)+"T05:00:00.000Z";a.currentDate=new Date(f,g-1,b.index+1),a.fnRepairOrders(h,c,d)}},grid:{y:{show:!0}},onrendered:function(){a.isDailyBarMsg=b.length===j,a.fnRefreshDom(),j=0},transition:{duration:1e3},bar:{width:{ratio:.5}},zoom:{enabled:!1},axis:{x:{label:{text:c,position:"outer-center"},type:"category",height:50,tick:{rotate:75,multiline:!1}},y:{label:{text:a.yAxiesLabel,position:"outer-middle"}}},tooltip:{grouped:!1,contents:function(b,c,d,e){var f=b[0].name,g=b[0].value,h=a.fnReturnTooltipVal(f,g),j='<table class="c3-tooltip"><tbody><tr><th colspan="2">'+a.dailyHeading+'</th></tr><tr class="c3-tooltip-name-'+f+'"><td class="name"><span style="background-color:'+i[f]+'"></span>'+a.dailyHeading+'</td><td class="value">'+h+'</td></tr><tr><td colspan="2">Click a day to see repair orders</td></tr></tbody></table>';return j}},legend:{hide:!0}})}}angular.forEach(a.createJSON[e.value],function(i,k){if(k===b){var l="",m=p.indexOf(i.month)+1;"Previous 12 months"===c&&m>s?l=t-2:"Previous 12 months"===c&&s>=m?l=t-1:"Most recent 12 months"===c&&m>s?l=t-1:"Most recent 12 months"===c&&s>=m&&(l=t),a.isDailySummaryData=g?g:!0,j.fetchMonthlyData(a.partnerId,f,l+"-"+m).then(function(b){a.isDailySummaryData=!0;var g=b.summaries;angular.forEach(g,function(b,c){var e=d("CentToDollar")(a.fnCalculateGrossProfitCent(b));b.gross_profit_cents=e;for(var f in b)b.hasOwnProperty(f)&&("labor_sold_cents_per_second"!==f&&f.split("_").indexOf("cents")>-1&&(b[f]=d("CentToDollar")(b[f])),"rate"===f.split("_").pop()&&(b[f]=d("multiplyBy100")(b[f])),f.split("_").indexOf("seconds")>-1&&(b[f]=d("hour")(b[f])));b.labor_sold_cents_per_second&&(b.labor_sold_cents_per_second=d("calEffectiveRate")(b.labor_sold_cents_per_second));var g=0!=b.total_labor_actual_seconds?(b.total_labor_sold_seconds/b.total_labor_actual_seconds).toFixed(2):0;b.shop_efficiency=g;var h=0!=b.sale_count?(b.total_labor_sold_seconds/b.sale_count).toFixed(2):0;b.sold_hours_per_ro=h}),a.dailyBarMonth=q[g[0].month-1],h(g,a.dailyBarMonth,c,e.value,l,m,f)})}}),a.yAxiesLabel=e.name,a.dailyHeading=e.name},a.fnCreateempPerformanceDD=function(){a.empPerformanceDDOptions=[{name:"Service Advisor Gross Sales",value:"gross_sales_cents"},{name:"Service Advisor Avg. RO",value:"avg_sale_cents"},{name:"Service Advisor RO Count",value:"sale_count"},{name:"Service Advisor Gross Profit",value:"gross_profit_cents"},{name:"Service Advisor Gross Profit %",value:"gross_profit_cents_per"},{name:"Tech Sold",value:"total_labor_sold_cents"},{name:"Tech Cost",value:"total_labor_cost_cents"},{name:"Tech Profit",value:"total_labor_profit_cents"},{name:"Tech Actual Time",value:"total_actual_seconds"},{name:"Tech Effective Labor Rate",value:"eff_labor_hourly_rate_cents"}],a.empPerformanceBarChartName=a.empPerformanceDDOptions[0].name,a.selectedEmpPerformanceOption=a.empPerformanceDDOptions[0].value},a.fnFetchWriterStatsByMonth=function(b){a.isEmpPerformanceDataLoaded=a.isEmpPerformanceMsg=!1,a.createEmpPerformanceJSON={},j.fetchWriterStatsByMonth(a.partnerId,b).then(function(c){a.fnCreateempPerformanceDD(),c.length>0?a.fnCreateEmpPerformanceChartJSON(c,c[0].writers[0],"writers"):a.isEmpPerformanceMsg=!0,a.fnFetchTechStatsByMonth(b)}),a.fnRefreshDom()},a.fnFetchTechStatsByMonth=function(b){j.fetchTechStatsByMonth(a.partnerId,b).then(function(b){a.isEmpPerformanceDataLoaded=!0,b.length>0&&a.fnCreateEmpPerformanceChartJSON(b,b[0].techs[0],"techs")})},a.fnCreateEmpPerformanceChartJSON=function(b,c,e){var f=c,g="_emp",h="gross_profit_cents_per";for(var i in f)f.hasOwnProperty(i)&&"name"!=i&&(a.createEmpPerformanceJSON[i]=[],a.createEmpPerformanceJSON[i+g]=[]);"undefined"!=typeof c&&"writers"===e&&(a.createEmpPerformanceJSON[h]=[],a.createEmpPerformanceJSON[h+g]=[]),angular.forEach(b,function(b){var c=p[b.month-1]+"-"+b.year;angular.forEach(b[e],function(b){if("writers"===e){var f=0==b.gross_sales_cents?0:(b.gross_profit_cents/b.gross_sales_cents*100).toFixed(2);"undefined"==typeof a.createEmpPerformanceJSON[h+g]&&(a.createEmpPerformanceJSON[h+g]=[]),"undefined"==typeof a.createEmpPerformanceJSON[h]&&(a.createEmpPerformanceJSON[h]=[]),-1===a.createEmpPerformanceJSON[h+g].indexOf(b.name)&&a.createEmpPerformanceJSON[h+g].push(b.name);var i=a.createEmpPerformanceJSON[h].map(function(a){return a.month}).indexOf(c);if(-1===i){var j={};j.month=c,j[b.name]=f,a.createEmpPerformanceJSON[h].push(j)}else angular.forEach(a.createEmpPerformanceJSON[h],function(a){a.month==c&&(a[b.name]=f)})}angular.forEach(b,function(e,f){if("name"!=f){"undefined"==typeof a.createEmpPerformanceJSON[f+g]&&(a.createEmpPerformanceJSON[f+g]=[]),"undefined"==typeof a.createEmpPerformanceJSON[f]&&(a.createEmpPerformanceJSON[f]=[]),-1===a.createEmpPerformanceJSON[f+g].indexOf(b.name)&&a.createEmpPerformanceJSON[f+g].push(b.name);var h=a.createEmpPerformanceJSON[f].map(function(a){return a.month}).indexOf(c);if(-1===h){var i={};i.month=c,f.split("_").indexOf("cents")>-1?i[b.name]=d("CentToDollar")(e):f.split("_").indexOf("seconds")>-1?i[b.name]=d("hour")(e):i[b.name]=b[f],a.createEmpPerformanceJSON[f].push(i)}else angular.forEach(a.createEmpPerformanceJSON[f],function(a){a.month==c&&(f.split("_").indexOf("cents")>-1?a[b.name]=d("CentToDollar")(e):f.split("_").indexOf("seconds")>-1?a[b.name]=d("hour")(e):a[b.name]=e)})}})})}),0==Object.keys(a.createEmpPerformanceJSON).length&&(a.isEmpPerformanceMsg=!0)},a.fnGenerateBarEmpPerChart=function(b){a.isEmpPerformanceMsg||0!=Object.keys(a.createEmpPerformanceJSON).length&&c3.generate({bindto:"#bar-chart-emp-performance",padding:{top:40,right:50},data:{json:a.createEmpPerformanceJSON[b],keys:{x:"month",value:a.createEmpPerformanceJSON[b+"_emp"]},type:"bar"},grid:{y:{show:!0}},transition:{duration:1e3},bar:{width:{ratio:.5}},zoom:{enabled:!1},axis:{x:{label:{text:"Month",position:"outer-center"},type:"category",height:100,tick:{rotate:-75,multiline:!1}}},tooltip:{format:{value:function(a,c,d){var e=b.split("_").indexOf("cents")>-1?d3.format("$"):d3.format(",");return b.split("_").indexOf("per")>-1?a+"%":e(a)}}}})},a.fnGeneratePieChart=function(b){if(a.pieChartTitle=p[b.month-1]+" "+b.year,a.isPieChartCustData){c3.generate({bindto:"#pie-chart",data:{json:a.createPieChartJson,type:"pie",onclick:function(a,b){},onmouseover:function(a,b){},onmouseout:function(a,b){}},tooltip:{grouped:!1,contents:function(b,c,d,e){
var f=b[0].name,g=b[0].value;"Newly Active"===f?e="#1F77B4":"Other Active"===f?e="#FF7F0E":"Lost"===f&&(e="#2CA02C");var h='<table class="c3-tooltip"><tbody><tr><th colspan="2">'+a.pieChartTitle+', Customers</th></tr><tr class="c3-tooltip-name-'+f+'"><td class="name"><span style="background-color:'+e+'"></span>'+f+'</td><td class="value">'+g+"</td></tr></tbody></table>";return h}}})}else a.isPieChartDataMsg=!0},a.custRepoOptions=[{name:"New Customers",value:"new_customers"},{name:"Active Customers",value:"active_customers"},{name:"Lost Customers",value:"lost_customers"}],a.fnCreatecustRepoDD=function(){a.custRepoOptions=[{name:"New Customers",value:"new_customers"},{name:"Active Customers",value:"active_customers"},{name:"Lost Customers",value:"lost_customers"}]},a.custRepoBarChartName=a.custRepoOptions[0].name,a.selectedCustRepoOptions=a.custRepoOptions[0].value,a.createCustRepoJSON={},a.sendCustRepoJsonToBar=[],a.fnFetchCustomerReport=function(b){a.isCustomerReportData=a.isPieChartCustData=!1,a.createCustRepoJSON={},j.fetchCustomerReport(a.partnerId,b).then(function(b){a.fnCreatecustRepoDD(),a.customerReportData=b,a.isCustomerReportData=a.isPieChartCustData=!0,a.fnCreateCustRepoJson(b)}),a.fnRefreshDom()},a.fnCreateCustRepoJson=function(b){var c=b[0],d="",e=[],f=[];for(var g in c)c.hasOwnProperty(g)&&(a.createCustRepoJSON[g]=[]);angular.forEach(b,function(b,g){var h=p[b.month-1];if(12>g?(d="Previous 12 months",-1===e.indexOf(d)&&e.push(d)):(d="Most recent 12 months",-1===e.indexOf(d)&&e.push(d)),-1!==f.indexOf(b.month))for(var i in c)c.hasOwnProperty(i)&&a.fnCheckMonthInObj(h,d,a.createCustRepoJSON[i],b[i]);else{f.push(b.month);for(var j in c)c.hasOwnProperty(j)&&a.fnPushObj(h,d,a.createCustRepoJSON[j],b[j])}}),a.setColumnValue=e,m(b[b.length-1]),a.fnGenerateCustomerReportBarChart(a.selectedCustRepoOptions)},a.fnGenerateCustomerReportBarChart=function(b){angular.forEach(a.custRepoOptions,function(c){c.value===b&&(a.custRepoBarChartName=c.name)}),a.sendCustRepoJsonToBar=a.createCustRepoJSON[b];var c=0;if(a.isCustRepoBarMsg=!1,a.isCustomerReportData){c3.generate({bindto:"#customer-report-bar-chart",padding:{top:40,right:50},data:{json:a.sendCustRepoJsonToBar,keys:{x:"month",value:a.setColumnValue},type:"bar",colors:{"Previous 12 months":"#1F77B4","Most recent 12 months":"#FF7F0E"},color:function(a,b){return 0===b.value&&c++,a},onclick:function(b){m("Most recent 12 months"===b.id?a.customerReportData[b.index+12]:a.customerReportData[b.index])}},grid:{y:{show:!0}},onrendered:function(){a.isCustRepoBarMsg=a.sendCustRepoJsonToBar.length+12===c,a.fnRefreshDom(),c=0},transition:{duration:1e3},bar:{width:{ratio:.5}},zoom:{enabled:!1},axis:{x:{label:{text:"Month",position:"outer-center"},type:"category",height:50,tick:{rotate:75,multiline:!1}},y:{label:{text:a.custRepoBarChartName,position:"outer-middle"}}},tooltip:{grouped:!1,contents:function(b,c,d,e){var f=b[0].name,g=b[0].value;"Previous 12 months"===f?e="#1F77B4":"Most recent 12 months"===f&&(e="#FF7F0E");var h='<table class="c3-tooltip"><tbody><tr><th colspan="2">'+a.custRepoBarChartName+'</th></tr><tr class="c3-tooltip-name-'+f+'"><td class="name"><span style="background-color:'+e+'"></span>'+f+'</td><td class="value">'+g+'</td></tr><tr><td colspan="2">Click a month to see <br/> Active/New/Lost Customers </td></tr></tbody></table>';return h}}})}},a.fnFetchMarketingSourceByMonth=function(b){a.isMarketingSourcesDataLoaded=a.isMarketingSourcesMsg=!1,j.fetchMarketingSourceByMonth(a.partnerId,b).then(function(b){a.isMarketingSourcesDataLoaded=!0,b.length>0?a.fnCreateMarketingSourceChartArr(b):a.isMarketingSourcesMsg=!0}),a.fnRefreshDom()},a.fnCreateMarketingSourceChartArr=function(b){a.createMarketingSourceArr=[],a.marketingSourceYAxisArr=[],a.isMarketingSourcesMsg=!1,angular.forEach(b,function(b){var c={};c.month=p[b.month-1]+"-"+b.year,angular.forEach(b.sources,function(b,d){c[d.trim()]=b,-1===a.marketingSourceYAxisArr.indexOf(d.trim())&&a.marketingSourceYAxisArr.push(d.trim())}),a.createMarketingSourceArr.push(c)}),0===a.marketingSourceYAxisArr.length&&(a.isMarketingSourcesMsg=!0),a.fnGenerateBarMSChart(a.createMarketingSourceArr,a.marketingSourceYAxisArr)},a.fnGenerateBarMSChart=function(b,c){c3.generate({bindto:"#bar-chart-marketing-sources",padding:{top:40,right:50},data:{json:b,keys:{x:"month",value:c},type:"bar"},grid:{y:{show:!a.isMarketingSourcesMsg}},transition:{duration:1e3},bar:{width:{ratio:.5}},zoom:{enabled:!1},axis:{x:{label:{text:"Month",position:"outer-center"},type:"category",height:100,tick:{rotate:-75,multiline:!1}}}})},a.fnInitDashboard=function(){a.partnerId=CarglyPartner.user.partnerId,a.fnCreatechartGroupsDD(),a.fnFetchAgentAppDownloadUrl()},a.fnRefreshDom=function(){a.$$phase||a.$apply()};var z={};withinviewport.defaults.left=0,withinviewport.defaults.right=-100,withinviewport.defaults.bottom=-200,$("#dashboard-tab").on("scroll",function(){var a=$("#content #dashboard-tab");a&&0!=a.length&&o()}),$(window).resize(function(){var a=$("#content #dashboard-tab");a&&0!=a.length&&o()})}]),app.controller("LocationsCtrl",["$scope","$mdSidenav","$rootScope","$mdDialog","$timeout","locationService",function(a,b,c,d,e,f){c.editLocation="",a.rightView="views/authenticated/locations/newLocation.html",a.rightEditView="views/authenticated/locations/manageLocation.html",a.isTabsLoad=!1,a.locationData=[],a.selectedLocationTab=0,a.fnOpenNewLocationSwap=function(){e(function(){a.rightView="",a.$apply(),a.rightView="views/authenticated/locations/newLocation.html",a.$apply(),b("newLocationView").open().then(function(){})})},a.newLocationView=function(){a.islocationEditable=!1,a.fnOpenNewLocationSwap()},a.closeNewLocationSwap=function(){b("newLocationView").close().then(function(){})},a.fnOpenLocationManageSwap=function(){e(function(){a.rightEditView="",a.$apply(),a.rightEditView="views/authenticated/locations/manageLocation.html",a.$apply(),b("manageLocationView").open().then(function(){a.isTabsLoad=!0})})},a.fnCloseLocationManageSwap=function(){b("manageLocationView").close().then(function(){a.isTabsLoad=!1,f.setLocationObj({})})},a.fnFetchLocationData=function(){a.isLocationMsgShow=a.isLocationDataNotNull=!1,f.fetchLocation().then(function(b){0!==b.length?(a.isLocationDataNotNull=!0,a.isLocationMsgShow=!1,a.locationData=b):(a.isLocationDataNotNull=!1,a.isLocationMsgShow=!0)},function(a){toastr.error("Failed retrieving location data.","STATUS CODE: "+a.status)})},a.locationAction='<div layout="row"><md-button class="md-icon-button md-accent" ng-click="grid.appScope.fnLocationEdit(row)">   <md-icon md-font-set="fa fa-lg fa-fw fa-eye"></md-icon>   <md-tooltip ng-if="$root.isMobile == null" md-direction="top">Open</md-tooltip></md-button><md-button class="md-icon-button md-warn" ng-click="grid.appScope.fnLocationDelete(row,$event);">   <md-icon md-font-set="fa fa-lg fa-fw fa-trash"></md-icon>   <md-tooltip ng-if="$root.isMobile == null" md-direction="top">Delete</md-tooltip></md-button></div>',a.locationGridOptions={data:"locationData",rowHeight:50,multiSelect:!1,enableRowSelection:!0,enableRowHeaderSelection:!1,enableVerticalScrollbar:0,columnDefs:[{field:"name",displayName:"Name",minWidth:100,enableHiding:!1},{field:"address",displayName:"Address",minWidth:100,enableHiding:!1},{field:"city",displayName:"City",minWidth:100,enableHiding:!1},{field:"state",displayName:"State",minWidth:100,enableHiding:!1},{field:"zip",displayName:"Zip",minWidth:100,enableHiding:!1},{name:"action",displayName:"",cellTemplate:a.locationAction,width:100,enableSorting:!1,enableColumnMenu:!1}],onRegisterApi:function(b){b.selection.on.rowSelectionChanged(a,function(a){a.isSelected=!0})}},a.fnLocationDelete=function(b,c){var e=d.confirm().title("Delete").content("Would you like to delete this location?").ariaLabel("Delete").ok("Delete").cancel("Cancel").targetEvent(c);d.show(e).then(function(){f.deleteLocation(b.entity.id).then(function(){a.fnFetchLocationData()})},function(){})},a.fnLocationEdit=function(b){a.editLocationName=b.entity.name,f.setLocationObj(b.entity),a.fnOpenLocationManageSwap()},a.$on("RefreshLocations",function(){a.fnFetchLocationData()}),a.fnInitLocations=function(){a.fnFetchLocationData()},c.rightView="views/authenticated/locations/newLocation.html",c.rightEditView="views/authenticated/locations/manageLocation.html"}]),app.controller("LocationInfoCtrl",["$scope","$rootScope","globalTimeZone","locationService","toastr",function(a,b,c,d,e){a.location={},a.timeZoneDDOptions=[],a.timeZoneDDOptions=c,a.isProcessing=!1,a.location=d.getLocationObj().id?angular.copy(d.getLocationObj()):{timezone:"US/Central"},a.saveLocation=function(c){var f=null;a.isProcessing=!0,c.id&&(f=c.id),d.saveLocation(f,c).then(function(d){null===d||d.location_id?(a.isProcessing=!1,b.$broadcast("RefreshLocations"),e.success("Location saved successfully.")):(a.isProcessing=!1,e.error("Location can't saved.Invalid information.")),c.id||a.$parent.closeNewLocationSwap()})},a.fnResetForm=function(){a.location={timezone:"US/Central"},a.locationForm.$setUntouched()}}]),app.controller("newLocationsCtrl",["$scope","$rootScope","toastr","globalTimeZone","locationService",function(a,b,c,d,e){a.location={timezone:"US/Central"},a.isProcessing=!1,a.fnSaveLocation=function(d){a.isProcessing=!0,e.saveLocation("",d).then(function(d){a.isProcessing=!1,b.$broadcast("RefreshLocations"),c.success("Location save successfully."),a.location={timezone:"US/Central"},a.locationForm.$setUntouched()},function(b){a.isProcessing=!1,c.error("Can't be saved, repeated email or invalid information.","STATUS CODE: "+b.status)}),a.closeNewLocationSwap()},a.fnInitLocation=function(){a.timeZoneDDOptions=d}}]),app.controller("recommendedServiceCtrl",["$scope","$http","$timeout","$mdSidenav","$log","$cookies","$state","$mdDialog","userService","locationService",function(a,b,c,d,e,f,g,h,i,j){a.recommendedServiceFilterOptions={filterText:"",useExternalFilter:!1},a.recommendedServiceTotalServerItems=0,a.pagingOptions={pageSizes:[5,10,25,50],pageSize:500,currentPage:1},a.getPagedDataAsync=function(b,c){setTimeout(function(){j.getLocationObj().id&&(a.locationID=j.getLocationObj().id,j.recommendedService(a.locationID).then(function(b){0!==b.length?(a.isDataNotNull=!0,a.recommendedServicesData=b):(a.isDataNotNull=!1,a.isMsgShow=!0)},function(a){})),$(".recommendedServiceGridStyle").trigger("resize")},100)},a.$on("refreshrecommendedServices",function(){a.getPagedDataAsync(a.pagingOptions.pageSize,a.pagingOptions.currentPage)}),a.getPagedDataAsync(a.pagingOptions.pageSize,a.pagingOptions.currentPage),a.recommendedServiceGridOptions={data:"recommendedServicesData",rowHeight:50,multiSelect:!1,enableRowSelection:!0,enableRowHeaderSelection:!1,enableVerticalScrollbar:0,columnDefs:[{field:"text",displayName:"Service",minWidth:"250",enableHiding:!1},{field:"recommended_date",displayName:"Date",cellFilter:"date:'MM/dd/yyyy, h:mm a'",minWidth:"170",enableHiding:!1},{field:"due_date",displayName:"Due Date",cellFilter:"date:'MM/dd/yyyy, h:mm a'",minWidth:"170",enableHiding:!1},{field:"recommendation_type",displayName:"Type",width:"100",enableHiding:!1},{field:"customer.first_name",displayName:"Customer Name",cellTemplate:'<div class="md-padding">{{row.entity.customer.first_name}} {{row.entity.customer.last_name}}</div>',minWidth:"200",enableHiding:!1},{field:"customer.phone_numbers",displayName:"Phone Numbers",cellFilter:"joinTelArray",minWidth:"190",enableHiding:!1}],onRegisterApi:function(b){b.selection.on.rowSelectionChanged(a,function(a){a.isSelected=!0})}}}]),app.controller("repairOrderCtrl",["$scope","$http","$timeout","$mdSidenav","$log","$cookies","$state","$mdDialog","userService","locationService",function(a,b,c,d,e,f,g,h,i,j){var k=5;a.repairOrderFilterOptions={filterText:"",useExternalFilter:!1},a.repairOrderTotalServerItems=0,a.pagingOptions={pageSizes:[5,10,25,50],pageSize:5,currentPage:1},a.getPagedDataAsync=function(){j.getLocationObj().id&&(a.locationID=j.getLocationObj().id,j.repairOrder(a.locationID).then(function(b){if(0!==b.length){a.isDataNotNull=!0,a.isMsgShow=!1,a.repairOrdersData=b;var c=angular.copy(b);a.gridApi?a.filteredData=a.gridApi.core.getVisibleRows(a.gridApi.grid):a.filteredData=c.slice(0,k)}else a.isDataNotNull=!1,a.isMsgShow=!0},function(a){}))},a.$on("refreshrepairOrders",function(){a.getPagedDataAsync(a.pagingOptions.pageSize,a.pagingOptions.currentPage)}),a.getPagedDataAsync(a.pagingOptions.pageSize,a.pagingOptions.currentPage),a.roAction='<div class="ui-grid-cell-contents padding-left-0">   <md-button class="md-icon-button md-accent" ng-click="grid.appScope.fnViewRODetails($event,row);">       <md-icon md-font-set="fa fa-lg fa-fw fa-external-link"></md-icon>       <md-tooltip ng-if="$root.isMobile == null" md-direction="top">View</md-tooltip>   </md-button></div>',a.repairOrderGridOptions={data:"repairOrdersData",rowHeight:50,multiSelect:!1,enableRowSelection:!0,enableRowHeaderSelection:!1,enableGridMenu:!0,enableVerticalScrollbar:0,paginationPageSize:5,paginationPageSizes:[5,10,25,50],columnDefs:[{displayName:"",name:"Action",cellTemplate:a.roAction,width:50,enableSorting:!1,enableColumnMenu:!1},{field:"closed",displayName:"Closed",cellFilter:"date:'MM/dd/yyyy h:mm a'",minWidth:180},{field:"inspection",displayName:"Inspection",cellFilter:"inspection",minWidth:100},{field:"order_number",displayName:"RO #",minWidth:100},{field:"customer.last_name",displayName:"Customer",minWidth:180},{field:"customer.phone_numbers",displayName:"Phone",cellFilter:"joinTelArray",minWidth:200},{field:"customer.email_addresses",displayName:"Email",cellFilter:"joinArray",minWidth:200},{field:"customer.postal_code",displayName:"Postal Code",minWidth:100},{field:"vehicle.year",displayName:"Year",minWidth:80},{field:"vehicle.make",displayName:"Make",minWidth:100},{field:"vehicle.model",displayName:"Model",minWidth:100},{field:"total_sold_price_cents",displayName:"Total RO $",cellFilter:"CentToDollar",minWidth:100},{field:"labor",displayName:"Sold",cellFilter:'sumOfValue:"sold_seconds" | toHHMMSS',visible:!1,minWidth:100},{field:"labor",displayName:"Actual",cellFilter:'sumOfValue:"actual_seconds" | toHHMMSS',visible:!1,minWidth:100}],onRegisterApi:function(b){a.gridApi=b,b.selection.on.rowSelectionChanged(a,function(a){a.isSelected=!0}),b.pagination.on.paginationChanged(a,function(b,c){a.filteredData=a.gridApi.core.getVisibleRows(a.gridApi.grid)})}},a.fnViewRODetails=function(b,c){a.fnOpenRepairOrderModal(b,c.entity)},a.fnOpenRepairOrderModal=function(b,c){h.show({controller:"repairOrderModalCtrl",templateUrl:"views/authenticated/locations/modals/roDetailsDialog.html",targetEvent:b,resolve:{repairOrder:function(){return c},repairOrders:function(){return a.repairOrdersData}}})},a.setClickedRow=function(b,c){a.selectedGroup=b,a.selectedRow=c}}]),app.controller("repairOrderModalCtrl",["$scope","$mdDialog","repairOrder","repairOrders",function(a,b,c,d){a.repairOrder=c,a.repairOrders=d,a.item={},a.position=a.repairOrders.indexOf(a.repairOrder),a.fnMove=function(b){a.position+=b,a.repairOrder=a.repairOrders[a.position]},a.$watch("repairOrder",function(){a.repairOrder.total_sold_price_cents=a.repairOrder.total_sold_price_cents?parseFloat(a.repairOrder.total_sold_price_cents):0,a.totalPartsSoldPrice=a.repairOrder.parts_sold_price_cents?parseFloat(a.repairOrder.parts_sold_price_cents):0;var b=a.repairOrder.parts_actual_cost_cents?parseFloat(a.repairOrder.parts_actual_cost_cents):0;a.totalLaborSoldPrice=a.repairOrder.labor_sold_price_cents?parseFloat(a.repairOrder.labor_sold_price_cents):0;var c=a.repairOrder.labor_actual_cost_cents?parseFloat(a.repairOrder.labor_actual_cost_cents):0,d=a.repairOrder.parts_discounted_cents?parseFloat(a.repairOrder.parts_discounted_cents):0,e=a.repairOrder.labor_discounted_cents?parseFloat(a.repairOrder.labor_discounted_cents):0,f=a.repairOrder.other_discounted_cents?parseFloat(a.repairOrder.other_discounted_cents):0;a.totalSubletSoldPrice=a.repairOrder.sublet_sold_price_cents?parseFloat(a.repairOrder.sublet_sold_price_cents):0;var g=a.repairOrder.sublet_actual_cost_cents?parseFloat(a.repairOrder.sublet_actual_cost_cents):0,h=a.repairOrder.sublet_discounted_cents?parseFloat(a.repairOrder.sublet_discounted_cents):0;a.partsProfitDlr=a.totalPartsSoldPrice-b,a.laborProfitDlr=a.totalLaborSoldPrice-c,a.subletProfitDlr=a.totalSubletSoldPrice-g,a.totalSoldPrice=a.totalPartsSoldPrice+a.totalLaborSoldPrice+a.totalSubletSoldPrice;var i=b+c+g,j=d+e+h+f;a.grossProfit=a.totalSoldPrice-i-j,a.discounts=d+e+f;var k,l;k=l=a.effectiveLaborRate=0,angular.forEach(a.repairOrder.labor,function(a){k+=a.sold_seconds,l+="undefined"==typeof a.sold_price_cents?0:parseFloat(a.sold_price_cents)}),l/=100,a.effectiveLaborRate=0!==k?l/k*3600:0}),a.hide=function(){b.hide()},a.fnInitInspectedItems=function(b,c){a.item[b]=$.grep(c,function(a){return a.name===b})[0]},a.setClickedRow=function(b,c){a.selectedGroup=b,a.selectedRow=c}}]),app.controller("CrmCtrl",["$scope",function(a){a.selectedCrmTab=0}]),app.controller("allCustomersCtrl",["$scope","cookieName","$cookies","$mdDialog","locationService","allCustomerService",function(a,b,c,d,e,f){a.isLocationsData=!1,a.locationOptions=[],a.idsObj={locationId:"",segmentId:""};var g="";a.customerIndex=0,a.vehicleObj=null,a.selectedRow=null,a.breadcrumbArr=[{name:"Customers"}],a.searchCustomerFilter="",a.isMsgShow=!1,a.customerFilter={},a.fnFilterKeyEvent=function(b){a.getPagedDataAsync(b,a.pagingOptions.pageSize,a.pagingOptions.currentPage)},a.customersFilterOptions={filterText:"",useExternalFilter:!1},a.customersTotalServerItems=0,a.pagingOptions={pageSizes:[5,10,25,50],pageSize:5,currentPage:1},a.setPagingData=function(b){var c=b;a.customersData=c,a.customersTotalServerItems=c.length,a.$$phase||a.$apply()},a.getPagedDataAsync=function(b,c,d){a.isDataNotNull=!1,a.isMsgShow=!1,g&&f.customersData(g,b).then(function(b){0!==b.length?(a.isDataNotNull=!0,a.isMsgShow=!1,a.setPagingData(b,d,c)):(a.isDataNotNull=!1,a.isMsgShow=!0)})},a.$watch("pagingOptions",function(b,c){b!==c&&(b.currentPage===c.currentPage&&1!==c.currentPage?a.pagingOptions.currentPage=1:a.getPagedDataAsync(a.pagingOptions.pageSize,a.pagingOptions.currentPage,a.customersFilterOptions.filterText))},!0),a.$watch("filterOptions",function(b,c){b!==c&&a.getPagedDataAsync(a.pagingOptions.pageSize,a.pagingOptions.currentPage,a.customersFilterOptions.filterText)},!0),a.customerAction='<div class="ui-grid-cell-contents padding-left-0">   <md-button class="md-icon-button md-accent" ng-click="grid.appScope.fnViewCustomerDetails($event,row);">       <md-icon md-font-set="fa fa-lg fa-fw fa-eye"></md-icon>       <md-tooltip ng-if="$root.isMobile == null" md-direction="top">Open</md-tooltip>   </md-button></div>',a.customersGridOptions={data:"customersData",rowHeight:50,enableRowSelection:!0,enableRowHeaderSelection:!1,enableVerticalScrollbar:0,enableFiltering:!0,multiSelect:!1,columnDefs:[{displayName:"",name:"Action",cellTemplate:a.customerAction,minWidth:50,width:"50",enableSorting:!1,enableColumnMenu:!1,enableFiltering:!1},{field:"first_name",displayName:"First Name",minWidth:200,enableHiding:!1},{field:"last_name",displayName:"Last Name",minWidth:200,enableHiding:!1},{field:"company",displayName:"Company",minWidth:200,enableHiding:!1},{field:"phone_numbers",displayName:"Phone",cellFilter:"joinTelArray",minWidth:200,enableHiding:!1},{field:"email_addresses",displayName:"Email",cellFilter:"joinArray",minWidth:200,enableHiding:!1}],onRegisterApi:function(b){b.selection.on.rowSelectionChanged(a,function(a){a.isSelected=!0})}},a.fnOnSelectBreadcrumb=function(b){a.customerIndex=b,a.breadcrumbArr.splice(b+1,a.breadcrumbArr.length)},a.fnViewCustomerDetails=function(b,c){a.intGridIndex=c.rowIndex,a.customerIndex=1,a.customer=c.entity,a.breadcrumbArr.push({name:c.entity.first_name+" "+c.entity.last_name})},a.fnViewVehicleDetails=function(b){a.customerIndex=2,a.vehicleObj=b,a.breadcrumbArr.push({name:b.year+" "+b.make+" "+b.model})},a.setClickedRow=function(b){a.selectedRow=b},a.fnChangeFilter=function(b){a.getPagedDataAsync(b,a.pagingOptions.pageSize,a.pagingOptions.currentPage)},a.fnGetLocationDetails=function(){a.isLocationsData=!1,e.fetchLocation().then(function(b){0!=b.length&&(a.isLocationsData=!0,a.fnCreateLocationDD(b))})},a.fnCreateLocationDD=function(b){a.locationOptions=[];for(var c=0,d=b.length;d>c;c++)a.locationOptions.push({name:b[c].name,id:b[c].id});g=a.idsObj.locationId=a.locationOptions[0].id,a.fnFilterKeyEvent(a.searchCustomerFilter)},a.fnChangeLocation=function(b){g=b,angular.element("#crm-pane #customerTab form input.filterBox").val(""),a.fnOnSelectBreadcrumb(0),a.getPagedDataAsync(a.searchCustomerFilter,a.pagingOptions.pageSize,a.pagingOptions.currentPage)},a.fnInitAllCustomers=function(){a.fnGetLocationDetails()}}]),app.controller("messageTemplatesCtrl",["$scope","$mdDialog","Toast","locationService","crmInteractionService","crmTemplateService","$timeout",function(a,b,c,d,e,f,g){a.locationOptions=[],a.isLocationsData=!1,a.crmSegmentsData=[],a.isCrmSegmentsData=a.isCrmSegmentsMsgShow=!1,a.locationId="",a.fnFilterByTemplateName=function(b){angular.forEach(a.crmSegmentsData,function(a){angular.forEach(b,function(b){return a.template_name===b.name?(a.html=b.html,a.preview_values=b.preview_values,!1):void 0})})},a.fnGetTemplatesData=function(){f.fetchClientTemplates(a.locationId).then(function(b){0!==b.length&&a.fnFilterByTemplateName(b)})},a.fnGetCombinedSegments=function(b){a.crmSegmentsData=[],angular.forEach(b,function(b){b.sub_segments&&0!==b.sub_segments.length&&angular.forEach(b.sub_segments,function(c){c.name=b.name+" \\ "+c.name,a.crmSegmentsData.push(c)})}),a.fnGetTemplatesData()},a.fnGetSegmentsData=function(){a.isCrmSegmentsData=a.isCrmSegmentsMsgShow=!1,a.locationId?e.fetchShopLocationSegments(a.locationId).then(function(b){0!==b.length?(a.isCrmSegmentsMsgShow=!1,a.isCrmSegmentsData=!0,a.fnGetCombinedSegments(b)):(a.isCrmSegmentsMsgShow=!0,a.isCrmSegmentsData=!1)}):c.failure("Location ID not found...")},a.crmSegmentsAction='<div class="ui-grid-cell-contents padding-left-0">   <md-button class="md-icon-button md-accent" ng-click="grid.appScope.fnOpenManageCrmSegments(row, ev);">       <md-icon md-font-set="fa fa-lg fa-fw fa-external-link"></md-icon>       <md-tooltip ng-if="$root.isMobile == null" md-direction="top">View</md-tooltip></md-button></div>',a.crmSegmentsGridOptions={data:"crmSegmentsData",rowHeight:50,multiSelect:!1,enableRowSelection:!0,enableRowHeaderSelection:!1,enableVerticalScrollbar:0,columnDefs:[{field:"name",displayName:"Segment Name",minWidth:250,enableHiding:!1},{name:"action",displayName:"",cellTemplate:a.crmSegmentsAction,width:50,enableSorting:!1,enableColumnMenu:!1}],onRegisterApi:function(b){b.selection.on.rowSelectionChanged(a,function(a){a.isSelected=!0})}},a.fnGenerateIframe=function(){g(function(){var b=angular.element("md-dialog#message-template-dialog #rendered-html")[0];b.src="about:blank",b.contentWindow.document.open("text/htmlreplace"),b.contentWindow.document.write(a.rendered_template.html),b.contentWindow.document.close(),b.contentWindow.document.onmousedown=function(){return!1}},1e3)},a.fnOpenManageCrmSegments=function(d,e){if(a.crmSubSegmentObj=d.entity,a.rendered_template={},a.crmSubSegmentObj.html){var g={};g.data=JSON.parse(a.crmSubSegmentObj.preview_values),g.template=a.crmSubSegmentObj.html,f.interpolateClientTemplate(g).then(function(b){a.rendered_template.html=b.rendered_template,a.fnGenerateIframe()},function(a){401!==a.status&&500!==a.status&&c.failure("Error interpolating template. Please try again...")})}else a.rendered_template.html="No template found.",a.fnGenerateIframe();b.show({scope:a.$new(),templateUrl:"views/authenticated/crm/modals/manageMessageTemplates.html",targetEvent:e}).then(function(){},function(){})},a.fnCloseMessageTemplateDialog=function(){b.hide()},a.fnChangeLocation=function(b){a.locationId=b,a.fnGetSegmentsData()},a.fnCreateLocationDD=function(b){a.locationOptions=[];for(var c=0,d=b.length;d>c;c++)a.locationOptions.push({name:b[c].name,id:b[c].id});a.locationId=a.locationOptions[0].id,a.fnGetSegmentsData()},a.fnGetLocationDetails=function(){a.isLocationsData=!1,d.fetchLocation().then(function(b){0!=b.length&&(a.isLocationsData=!0,a.fnCreateLocationDD(b))})},a.fnInitCrmSegments=function(){a.fnGetLocationDetails()}}]),app.controller("customerStatisticsCtrl",["$scope","$timeout","$filter","NgMap","locationService","allCustomerService",function(a,b,c,d,e,f){function g(){b.cancel(a.timer);for(var c=0;c<m.length;c++)m[c].setMap(null);m=[]}function h(d,e){b(function(){a.totalCustomersFound+=1,a.$apply()});var f=new google.maps.Marker({position:d,map:a.ngMap,animation:google.maps.Animation.DROP});m.push(f);for(var g="<div><h4>"+e._fullName+"</h4><div>"+e._formattedAddress+'</div><div><span class="leftLabel">Last Visit: </span>'+c("date")(e.last_seen,"MM/dd/yyyy h:mm a")+'</div><div><table class="mapTable" style="width: 300px;"><thead><tr><th colspan="4">Vehicles Info</th></tr><tr><th>Model</th><th>Make</th><th>License</th><th>Year</th></tr></thead<tbody>',h=0;h<e.vehicles.length;h++)g+="<tr><td>"+e.vehicles[h].model+"</td><td>"+e.vehicles[h].make+"</td><td>"+e.vehicles[h].license+"</td><td>"+e.vehicles[h].year+"</td></tr>";g+="</tbody></table></div>",google.maps.event.addListener(f,"mouseover",function(){n.setContent(g),n.open(a.ngMap,f)})}function i(b){var c=[];return angular.forEach(b.vehicles,function(b){b.model==a.selectedModel&&c.push(b)}),c}function j(b,c){if(""!==a.searchText&&a.selectedModel&&""!==a.selectedModel){c.vehicles=i(c);var d=c._fullName.search(new RegExp(a.searchText,"i")),e=c._formattedAddress.search(new RegExp(a.searchText,"i"));-1==d&&-1==e||0!=c.vehicles.length&&h(b,c)}else if(""!==a.searchText){var d=c._fullName.search(new RegExp(a.searchText,"i")),e=c._formattedAddress.search(new RegExp(a.searchText,"i"));-1==d&&-1==e||0!=c.vehicles.length&&h(b,c)}else a.selectedModel&&""!==a.selectedModel?(c.vehicles=i(c),0!=c.vehicles.length&&h(b,c)):h(b,c)}function k(b){o.geocode({address:b._fullAddress},function(c,d){d===google.maps.GeocoderStatus.OK?(a.ngMap.setCenter(c[0].geometry.location),b._formattedAddress=c[0].formatted_address,b._position=c[0].geometry.location,a.customersStatData.filter(function(a){return b.id===a.id?(a._fullName=b._fullName,a._fullAddress=b._fullAddress,a._formattedAddress=b._formattedAddress,a._position=b._position,!1):void 0}),j(c[0].geometry.location,angular.copy(b))):console.log("Geocode was not successful for the following reason: "+d)})}a.locationId="",a.locationOptions=[],a.isDataNotNull=a.isMsgShow=a.isLocationsData=!1,a.customersStatData=[],a.pieChartJSON={},a.selectedModel="",a.mapLabel="Loading Map...",a.searchText="",a.totalCustomersFound=0,a.isProcessing=!1;var l=0,m=[],n=new google.maps.InfoWindow,o=new google.maps.Geocoder;a.timer,a.ngMap,a.fnGeneratePieChart=function(){c3.generate({bindto:"#pie-chart",data:{json:a.pieChartJSON,type:"pie"},tooltip:{grouped:!1,contents:function(a,b,c,d){var e=a[0].name,f=a[0].value;d="Email"===e?"#1F77B4":"#FF7F0E";var g='<table class="c3-tooltip"><tbody><tr><th colspan="2">Customers Email Count</th></tr><tr class="c3-tooltip-name-'+e+'"><td class="name"><span style="background-color:'+d+'"></span>'+e+'</td><td class="value">'+f+"</td></tr></tbody></table>";return g}}})},a.fnGetEmailData=function(b){a.pieChartJSON={Email:0,"No-Email":0},b.filter(function(b){"string"==typeof b.email_addresses?""===b.email_addresses?a.pieChartJSON["No-Email"]+=1:a.pieChartJSON.Email+=1:0===b.email_addresses.length?a.pieChartJSON["No-Email"]+=1:a.pieChartJSON.Email+=1})},a.fnInitMarkers=function(c,d){if(l>=d.length)return void(a.mapLabel="Completed...");for(var e=c.length>5?5:c.length,f=0;e>f;f++,l++)if(d[l]._position)j(d[l]._position,angular.copy(d[l]));else{var g=c[f],h=g.address1+" "+g.city+" "+g.postal_code+" "+g.state;h=h.replace(/#/g,""),g._fullName=g.first_name+" "+g.last_name,g._fullAddress=h,k(g)}return c.splice(0,e),0==c.length?void(a.mapLabel="Completed..."):void(a.timer=b(function(){},5e3).then(function(){a.fnInitMarkers(c,d)}))},a.fnInitMap=function(){l=0,a.mapLabel="Locating customers...",a.totalCustomersFound=0,d.getMap().then(function(b){a.ngMap=b;var c=angular.copy(a.customersStatData);a.fnInitMarkers(c,a.customersStatData)},function(b){console.log(b),a.mapLabel="Completed..."})},a.getPagedDataAsync=function(){a.isDataNotNull=a.isMsgShow=!1,a.customersStatData=[],a.isProcessing=!0,a.locationId&&f.customersData(a.locationId).then(function(b){0!==b.length?(a.isDataNotNull=!0,a.isProcessing=a.isMsgShow=!1,a.customersStatData=b,a.fnCreateVehicleDD(b),a.fnInitMap(),a.fnGetEmailData(b)):(a.isProcessing=a.isDataNotNull=!1,a.isMsgShow=!0)})},a.fnLocateMarkers=function(b){a.selectedModel=b,g(),a.fnInitMap()},a.fnCreateVehicleDD=function(b){a.vehicleDD=[];var d=angular.copy(b);angular.forEach(d,function(b){angular.forEach(b.vehicles,function(b){""!==b.model&&a.vehicleDD.push(b)})}),a.vehicleDD=c("unique")(a.vehicleDD,"model"),a.selectedModel=""},a.fnSearchCustomer=function(b){b?(a.searchText=b,b+="",b.trim().length>=5&&(a.searchText=b,g(),a.fnInitMap())):(b||""===b)&&(a.searchText=b,g(),a.fnInitMap())},a.$on("$destroy",function(){a.mapLabel="Completed...",b.cancel(a.timer),g()}),a.fnGetLocationDetails=function(){a.isLocationsData=!1,e.fetchLocation().then(function(b){0!=b.length&&(a.isLocationsData=!0,a.fnCreateLocationDD(b))})},a.fnCreateLocationDD=function(b){a.locationOptions=[];for(var c=0,d=b.length;d>c;c++)a.locationOptions.push({name:b[c].name,id:b[c].id});a.locationId=a.locationOptions[0].id,a.getPagedDataAsync()},a.fnChangeLocation=function(b){g(),a.locationId=b,a.getPagedDataAsync()},a.fnInitCustomerStatistics=function(){a.fnGetLocationDetails()}}]),app.controller("manageScheduledMessagesCtrl",["$scope","$mdDialog","$filter","crmInteractionObj",function(a,b,c,d){a.crmInteraction=a.repairOrder=void 0,a.crmInteraction=angular.copy(d),a.isProcessing=!1,a.item={},a.crmInteraction&&(a.crmInteraction.due_date=c("date")(a.crmInteraction.due_date,"MM/dd/yyyy h:mm a"),a.repairOrder=a.crmInteraction.repair_order),a.fnInitInspectedItems=function(b,c){a.item[b]=$.grep(c,function(a){return a.name===b})[0]},a.fnCloseDialog=function(){b.hide()},a.setClickedRow=function(b,c){a.selectedGroup=b,a.selectedRow=c}}]),app.controller("messageHistoryCtrl",["$scope","cookieName","$cookies","$mdDialog","locationService","crmInteractionService",function(a,b,c,d,e,f){a.isLocationsData=a.isSegmentsData=!1,a.isCrmInteractionData=a.isMoreCrmInteractions=!1,a.isCrmMsgGridShow=!1,a.crmInteractionData=a.filter={},a.locationOptions=[],a.segmentsOptions=[],a.idsObj={locationId:"",segmentId:""},a.isPagingData=!0,a.pagingOptions={pageSize:20,currentPage:1},a.filter={page_num:a.pagingOptions.currentPage,page_size:a.pagingOptions.pageSize,from:moment().format("YYYY-MM-DD"),to:moment().add(1,"months").format("YYYY-MM-DD")},a.getPagedDataAsync=function(b,c){a.isCrmInteractionData=!1,a.isCrmMsgGridShow=!1,f.fetchCrmInteraction(b,c).then(function(b){var c=[];b.filter(function(a){"SCHEDULED"!==a.status&&c.push(a)}),b=c,0!==b.length?(a.isCrmMsgGridShow=!1,a.isCrmInteractionData=!0,a.crmInteractionData=b):(a.isCrmMsgGridShow=!0,a.isCrmInteractionData=!1)})},a.nameTmpl='<div class="ui-grid-cell-contents">   {{row.entity.customer.first_name}}&nbsp;{{ row.entity.customer.last_name}}</div>',a.infoTmpl='<div layout="row" layout-padding><div class="padding-0"><div> Email: {{row.entity.customer.email_addresses | joinArray}} </div>     <div> Phone: {{row.entity.customer.phone_numbers | tel | joinTelArray}} </div>     <div> Address: {{row.entity.customer.address1}} </div></div></div>',a.crmInteractionAction='<div class="ui-grid-cell-contents padding-left-0">   <md-button class="md-icon-button md-accent" ng-click="grid.appScope.fnOpenCrmInteraction(row);">       <md-icon md-font-set="fa fa-lg fa-fw fa-external-link"></md-icon>       <md-tooltip ng-if="$root.isMobile == null" md-direction="top">View</md-tooltip>   </md-button></div>',
a.crmInteractionGridOptions={data:"crmInteractionData",rowHeight:80,multiSelect:!1,enableRowSelection:!0,enableRowHeaderSelection:!1,enableVerticalScrollbar:0,columnDefs:[{name:"Action",displayName:"",cellTemplate:a.crmInteractionAction,width:50,enableSorting:!1,enableColumnMenu:!1},{field:"due_date",displayName:"Due Date",cellFilter:"date:'MM/dd/yyyy h:mm a'",minWidth:180,enableHiding:!1},{name:"name",cellTemplate:a.nameTmpl,displayName:"Customer Name",minWidth:180,enableHiding:!1},{name:"customerName",cellTemplate:a.infoTmpl,displayName:"Customer Info",minWidth:200,width:250,enableHiding:!1},{field:"delivery_type",displayName:"Delivery",minWidth:100,enableHiding:!1},{field:"status",displayName:"Status",minWidth:100,enableHiding:!1},{field:"repair_order.closed",displayName:"Closed",cellFilter:"date:'MM/dd/yyyy h:mm a'",minWidth:180,enableHiding:!1}],onRegisterApi:function(b){b.selection.on.rowSelectionChanged(a,function(a){a.isSelected=!0})}},a.fnRefreshGrid=function(b){a.filter.page_num=1,a.isPagingData=!0,a.getPagedDataAsync(b,a.filter)},a.fnDownloadInteractionCSV=function(a,e){var f=c.get(b),g=["$scope","$window","locationId","segmentId",function(a,b,c,e){a.fnDownload=function(){d.hide(),a.downloadLink="https://carglyplatform.appspot.com/partners/api/crm/"+c+"/segments/"+e+"/interactions.csv?oauth_token="+f,b.open(a.downloadLink,"_blank")},a.fnHide=function(){d.hide()}}];d.show({locals:e,controller:g,template:'<md-dialog aria-label="Alert Dialog">  <md-dialog-content class="md-padding" layout-padding>      <div class="md-title"> Download Interaction CSV </div>      <p>This could take some time. Are you sure..?</p>  </md-dialog-content>  <md-dialog-actions>       <md-button aria-label="download"            class="md-raised md-accent" ng-click="fnDownload();">Download</md-button>       <md-button aria-label="cancel" class="md-raised" ng-click="fnHide();">Cancel</md-button>  </md-dialog-actions></md-dialog>',targetEvent:a}).then(function(){},function(a){})},a.fnOpenCrmInteraction=function(b){a.fnOpenCrmInteractionModal(b.entity)},a.fnOpenCrmInteractionModal=function(a){d.show({controller:"manageScheduledMessagesCtrl",templateUrl:"views/authenticated/crm/modals/manageScheduledMessages.html",resolve:{crmInteractionObj:function(){return a}}})},a.fnGetLocationDetails=function(){a.isLocationsData=!1,e.fetchLocation().then(function(b){0!=b.length&&(a.isLocationsData=!0,a.fnCreateLocationDD(b))})},a.fnCreateLocationDD=function(b){a.locationOptions=[];for(var c=0,d=b.length;d>c;c++)a.locationOptions.push({name:b[c].name,id:b[c].id});a.idsObj.locationId=a.locationOptions[0].id,a.fnGetSegmentsDetails(a.idsObj.locationId)},a.fnChangeLocation=function(b){a.filter.page_num=1,a.isPagingData=!0,a.fnGetSegmentsDetails(b)},a.fnGetSegmentsDetails=function(b){a.isSegmentsData=!1,f.fetchShopLocationSegments(b).then(function(b){0!=b.length&&(a.isSegmentsData=!0,a.fnCreateSegmentsDD(b))})},a.fnCreateSegmentsDD=function(b){a.segmentsOptions=[];for(var c=0,d=b.length;d>c;c++)a.segmentsOptions.push({name:b[c].name,id:b[c].id});a.idsObj.segmentId=a.segmentsOptions[0].id,a.getPagedDataAsync(a.idsObj,a.filter)},a.fnChangeSegment=function(b){a.getPagedDataAsync(b,a.filter)},a.fnLoadMoreCrmInteractions=function(b){a.filter.page_num+=1,a.isMoreCrmInteractions=!0,a.isPagingData=!0,f.fetchCrmInteraction(b,a.filter).then(function(b){b=b.filter(function(a){return"SCHEDULED"!==a.status?a:void 0}),0!=b.length?(a.crmInteractionData=a.crmInteractionData.concat(b),a.isMoreCrmInteractions=!1):a.isMoreCrmInteractions=a.isPagingData=!1})},a.fnInitMessageHistory=function(){a.fnGetLocationDetails()}}]),app.controller("scheduledMessagesCtrl",["$scope","cookieName","$filter","$cookies","$mdDialog","$timeout","encodeParamService","locationService","crmInteractionService",function(a,b,c,d,e,f,g,h,i){function j(){var b=$("#scheduled-messages-tab #pickDateRange").daterangepicker("getRange");b?(a.filter.from=c("date")(b.start,"yyyy-MM-dd"),a.filter.to=c("date")(b.end,"yyyy-MM-dd")):(delete a.filter.from,delete a.filter.to),a.fnChangeFilter(a.filter)}a.isLocationsData=a.isSegmentsData=!1,a.isCrmInteractionData=a.isMoreCrmInteractions=!1,a.isCrmMsgGridShow=!1,a.crmInteractionData=a.filter={},a.locationOptions=[],a.segmentsOptions=[],a.idsObj={locationId:"",segmentId:""},a.isPagingData=!0,a.pagingOptions={pageSize:20,currentPage:1},a.filter={page_num:a.pagingOptions.currentPage,page_size:a.pagingOptions.pageSize,status:"",deliveryType:""},a.getPagedDataAsync=function(b,c){a.isCrmInteractionData=!1,a.isCrmMsgGridShow=!1,i.fetchCrmInteraction(b,c).then(function(b){0!==b.length?(a.isCrmMsgGridShow=!1,a.isCrmInteractionData=!0,a.crmInteractionData=b):(a.isCrmMsgGridShow=!0,a.isCrmInteractionData=!1)})},a.nameTmpl='<div class="ui-grid-cell-contents">   {{row.entity.customer.first_name}}&nbsp;{{ row.entity.customer.last_name}}</div>',a.infoTmpl='<div layout="row" layout-padding><div class="padding-0"><div> Email: {{row.entity.customer.email_addresses | joinArray}} </div>     <div> Phone: {{row.entity.customer.phone_numbers | tel | joinTelArray}} </div>     <div> Address: {{row.entity.customer.address1}} </div></div></div>',a.crmInteractionAction='<div class="ui-grid-cell-contents padding-left-0"><md-button class="md-icon-button md-accent" ng-click="grid.appScope.fnOpenCrmInteraction(row);">   <md-icon md-font-set="fa fa-lg fa-fw fa-external-link"></md-icon>   <md-tooltip ng-if="$root.isMobile == null" md-direction="top">View</md-tooltip></md-button></div>',a.crmInteractionGridOptions={data:"crmInteractionData",rowHeight:80,multiSelect:!1,enableRowSelection:!0,enableRowHeaderSelection:!1,enableVerticalScrollbar:0,columnDefs:[{name:"Action",displayName:"",cellTemplate:a.crmInteractionAction,width:50,enableSorting:!1,enableColumnMenu:!1},{field:"due_date",displayName:"Due Date",cellFilter:"date:'MM/dd/yyyy h:mm a'",minWidth:150,enableHiding:!1},{name:"name",cellTemplate:a.nameTmpl,displayName:"Customer Name",minWidth:150,enableHiding:!1},{name:"customerInfo",cellTemplate:a.infoTmpl,displayName:"Customer Info",minWidth:250,enableHiding:!1},{field:"delivery_type",displayName:"Delivery",width:100,enableHiding:!1},{field:"status",displayName:"Status",width:100,enableHiding:!1},{field:"repair_order.closed",displayName:"Closed",cellFilter:"date:'MM/dd/yyyy h:mm a'",minWidth:180,enableHiding:!1}],onRegisterApi:function(b){b.selection.on.rowSelectionChanged(a,function(a){a.isSelected=!0})}},a.fnRefreshGrid=function(){j()},a.fnDownloadInteractionCSV=function(c,f){var h=d.get(b),i=["$scope","$window","idsObj","filterObj",function(a,b,c,d){var f=angular.copy(d);angular.forEach(f,function(a,b){"page_num"!==b&&"page_size"!==b||delete f[b]}),f.oauth_token=h,a.fnDownload=function(){e.hide(),a.downloadLink="https://carglyplatform.appspot.com/partners/api/crm/"+c.locationId+"/segments/"+c.segmentId+"/interactions.csv"+g.getEncodedParams(f),b.open(a.downloadLink,"_blank")},a.fnHide=function(){e.hide()}}];e.show({locals:{idsObj:f,filterObj:a.filter},controller:i,template:'<md-dialog aria-label="Alert Dialog">  <md-dialog-content class="md-padding" layout-padding>      <div class="md-title"> Download Interaction CSV </div>      <p>This could take some time. Are you sure..?</p>  </md-dialog-content>  <md-dialog-actions>       <md-button aria-label="download"            class="md-raised md-accent" ng-click="fnDownload();">Download</md-button>       <md-button aria-label="cancel" class="md-raised" ng-click="fnHide();">Cancel</md-button>  </md-dialog-actions></md-dialog>',targetEvent:c}).then(function(){},function(a){})},a.fnOpenCrmInteraction=function(b){a.fnOpenCrmInteractionModal(b.entity)},a.fnOpenCrmInteractionModal=function(a){e.show({controller:"manageScheduledMessagesCtrl",templateUrl:"views/authenticated/crm/modals/manageScheduledMessages.html",resolve:{crmInteractionObj:function(){return a}}})},a.fnGetLocationDetails=function(){a.isLocationsData=!1,h.fetchLocation().then(function(b){0!=b.length&&(a.isLocationsData=!0,a.fnCreateLocationDD(b))})},a.fnCreateLocationDD=function(b){a.locationOptions=[];for(var c=0,d=b.length;d>c;c++)a.locationOptions.push({name:b[c].name,id:b[c].id});a.idsObj.locationId=a.locationOptions[0].id,a.fnGetSegmentsDetails(a.idsObj.locationId)},a.fnChangeLocation=function(b){a.filter.page_num=1,a.isPagingData=!0,delete a.filter.from,delete a.filter.to,a.filter.status="",a.filter.deliveryType="",$("#scheduled-messages-tab #pickDateRange").daterangepicker("clearRange"),a.fnGetSegmentsDetails(b)},a.fnGetSegmentsDetails=function(b){a.isSegmentsData=!1,i.fetchShopLocationSegments(b).then(function(b){0!==b.length&&(a.isSegmentsData=!0,a.fnCreateSegmentsDD(b))})},a.fnCreateSegmentsDD=function(b){a.segmentsOptions=[];for(var c=0,d=b.length;d>c;c++)a.segmentsOptions.push({name:b[c].name,id:b[c].id});a.idsObj.segmentId=a.segmentsOptions[0].id},a.fnChangeSegment=function(b){a.filter.page_num=1,a.isPagingData=!0,delete a.filter.from,delete a.filter.to,a.filter.status="",a.filter.deliveryType="",$("#scheduled-messages-tab #pickDateRange").daterangepicker("clearRange"),a.getPagedDataAsync(b,a.filter)},a.fnLoadMoreCrmInteractions=function(b){a.filter.page_num+=1,a.isMoreCrmInteractions=!0,a.isPagingData=!0,i.fetchCrmInteraction(b,a.filter).then(function(b){0!=b.length?(a.crmInteractionData=a.crmInteractionData.concat(b),a.isMoreCrmInteractions=!1):a.isMoreCrmInteractions=a.isPagingData=!1})},a.fnChangeFilter=function(b){b.page_num=1,a.isPagingData=!0,a.getPagedDataAsync(a.idsObj,b)},a.fnCreateDateRangePicker=function(){f(function(){$("#scheduled-messages-tab #pickDateRange").daterangepicker({datepickerOptions:{numberOfMonths:2,maxDate:null},presetRanges:[],initialText:"Select period...",onChange:function(){a.fnRefreshGrid()}})},1e3),a.getPagedDataAsync(a.idsObj,a.filter)},a.fnInitScheduledMessages=function(){a.fnGetLocationDetails()}}]),app.controller("ProductsCtrl",function(){}),app.controller("LocationSetupCtrl",["$scope","accountServices",function(a,b){a.steps=[{title:"Download Setup Program","class":"",description:"Download Location Setup from"},{title:"Run Setup Program","class":"run-setup-bg",description:"Click on run to install RS Marketing Tools in your system."},{title:"Welcome","class":"welcome-setup-wizard-bg",description:"Click on next to start installation process."},{title:"Select Destination Location","class":"set-destination-location-bg",description:"Select your destination path where you want to install the program."},{title:"Select Location Shortcut","class":"select-start-menu-folder-bg",description:"Select start menu folder, where should setup place the program's shortcut?"},{title:"Ready To Install","class":"ready-to-install-bg",description:"click on install to begin installation."},{title:"Installing","class":"installing-bg",description:"Installing program in progress"},{title:"Setup Your Shop login","class":"setup-login-bg",description:"For setup your shop please login."},{title:"After Login","class":"loggedin-bg",description:"Please click on 'Next Select Shop Location' button."},{title:"Select Shop Location","class":"setup-details-bg",description:"Please set up your shop location and click on 'Next Connect Shop Database' button."},{title:"Connect Shop Database","class":"connect-shop-database-bg",description:"Please configure your database and click on 'Finish' button."},{title:"Finish","class":"finishing-setup-bg",description:"Finish setup shop process."}],a.fnInitLocSetup=function(){a.fnFetchAgentAppDownloadUrl()},a.fnFetchAgentAppDownloadUrl=function(){b.fetchAccount(CarglyPartner.user.id).then(function(b){a.appDownloadUrl=b.appDownloadUrl})}}]),app.controller("SettingsCtrl",["$scope","$stateParams",function(a,b){a.tabs=[{title:"ACCOUNT SETTINGS",viewName:"account",settingsName:"account",path:"views/authenticated/settings/accountSettings.html"},{title:"USERS",viewName:"user",settingsName:"users",path:"views/authenticated/settings/users.html"},{title:"BILLING HISTORY",viewName:"billingHistory",settingsName:"billingHistory",path:"views/authenticated/settings/billingHistory.html"}],a.selectedIndex=0,a.tabInit=function(){for(var c=0;c<a.tabs.length;c++)a.tabs[c].settingsName===b.settingsName&&(a.selectedIndex=c)}}]),app.controller("AccountSettingsCtrl",["$scope","accountServices","$mdDialog","toastr","globalTimeZone","$stateParams",function(a,b,c,d,e,f){a.isProcessing=!1,a.isSaveBtnDisabled=!1,a.updateAccountForm=function(){CarglyPartner.accountInfo&&(a.user={businessName:CarglyPartner.accountInfo.businessName,website:CarglyPartner.accountInfo.website,address:CarglyPartner.accountInfo.address,city:CarglyPartner.accountInfo.city,state:CarglyPartner.accountInfo.state,zip:CarglyPartner.accountInfo.zip,timezone:CarglyPartner.accountInfo.timezone,contactName:CarglyPartner.accountInfo.contactName,paymentProcessingSecretKey:CarglyPartner.accountInfo.paymentProcessingSecretKey,paymentProcessingPublicKey:CarglyPartner.accountInfo.paymentProcessingPublicKey,paymentProcessingAccountId:CarglyPartner.accountInfo.paymentProcessingAccountId},a.paymentInfo={subscriptionType:"None ($0.00/month)",cardType:CarglyPartner.accountInfo.cardType,cardLast4:CarglyPartner.accountInfo.cardLast4},a.email=CarglyPartner.accountInfo.email)},a.fnInitAccount=function(){a.timeZoneDDOptions=e,"account"==f.settingsName&&a.fetchAccount()},a.fetchAccount=function(){a.isProcessing=!0,b.fetchAccount(CarglyPartner.user.id).then(function(b){a.isProcessing=!1,CarglyPartner.accountInfo=b,a.updateAccountForm()})},a.$on("refreshFetchAccount",function(){a.fetchAccount()}),a.cancel=function(){a.fetchAccount()},a.updateUser=function(){var c=CarglyPartner.user.id;0===c.length&&(c=null),a.isProcessing=!0,a.isSaveBtnDisabled=!0,b.updateAccount(c,a.user).then(function(b){null===b?(a.fetchAccount(),d.success("Account information saved successfully.")):d.error("Account information can't saved."),a.isProcessing=!1,a.isSaveBtnDisabled=!1})},a.openUserPaymentInfo=function(a){c.show({controller:"paymentInfoCtrl",templateUrl:"views/authenticated/settings/modals/updatePaymentInfo.html",targetEvent:a})}}]),app.controller("UsersCtrl",["$scope","$mdSidenav","$mdDialog","$stateParams","userService",function(a,b,c,d,e){a.rightView="views/authenticated/settings/manageUser.html",a.fnNewUserView=function(){a.userName="New User",a.isUserEditable=!1,a.fnOpenSwap()},a.getPagedDataAsync=function(){setTimeout(function(){e.fetchUsers().then(function(b){0!==b.length?(a.isDataNotNull=!0,a.isMsgShow=!1,CarglyPartner.users=b,a.usersData=b):(a.isDataNotNull=!1,a.isMsgShow=!0)})},100)},a.$on("refreshUsers",function(){a.getPagedDataAsync()}),a.fnInitUsers=function(){"users"==d.settingsName&&a.getPagedDataAsync()},a.userAction='<div layout="row"> <md-button class="md-icon-button md-accent" ng-click="grid.appScope.fnUserEdit(row,$event);">   <md-icon md-font-set="fa fa-lg fa-fw fa-pencil"></md-icon>   <md-tooltip ng-if="$root.isMobile == null" md-direction="top">Edit</md-tooltip></md-button></md-button><md-button class="md-icon-button md-warn" ng-click="grid.appScope.fnUserDelete(row,$event)">   <md-icon md-font-set="fa fa-lg fa-fw fa-trash"></md-icon>   <md-tooltip ng-if="$root.isMobile == null" md-direction="top">Delete</md-tooltip></md-button> </div>',a.userGridOptions={data:"usersData",rowHeight:50,multiSelect:!1,enableRowSelection:!0,enableRowHeaderSelection:!1,enableVerticalScrollbar:0,columnDefs:[{field:"name",displayName:"Name",minWidth:180,enableHiding:!1},{field:"email",displayName:"Email",minWidth:200,enableHiding:!1},{field:"role",displayName:"Role",minWidth:100,enableHiding:!1},{field:"verified",displayName:"Verified",minWidth:100,enableHiding:!1},{name:"action",displayName:"",cellTemplate:a.userAction,width:100,enableSorting:!1,enableColumnMenu:!1}],onRegisterApi:function(b){b.selection.on.rowSelectionChanged(a,function(a){a.isSelected=!0})}},a.fnUserDelete=function(b,d){var f=c.confirm().title("Delete").content("Would you like to delete this user?").ariaLabel("Delete").ok("Delete").cancel("Cancel").targetEvent(d);c.show(f).then(function(){e.deleteUser(b.entity.id).then(function(){a.getPagedDataAsync()})})},a.fnUserEdit=function(b){a.isUserEditable=!0,a.intIndex=b.rowIndex,a.userName=b.entity.name,e.setUserObj(b.entity),a.fnOpenSwap()},a.fnOpenSwap=function(){setTimeout(function(){a.rightView="",a.$apply(),a.rightView="views/authenticated/settings/manageUser.html",a.$apply(),b("userSwap").open().then(function(){})})},a.fnCloseSwap=function(){b("userSwap").close().then(function(){})}}]),app.controller("BillingHistoryCtrl",["$scope","$stateParams","$state","$rootScope","billingHistoryService",function(a,b,c,d,e){a.billingHistoryFilterOptions={useExternalFilter:!1},a.billingHistoryTotalServerItems=0,a.setPagingData=function(b){a.billingHistoryData=b,a.billingHistoryTotalServerItems=b.length,a.$$phase||a.$apply()},a.getPagedDataAsync=function(){e.fetchBillingHistory().then(function(b){0!==b.length?(a.isDataNotNull=!0,a.isMsgShow=!1,a.setPagingData(b)):(a.isDataNotNull=!1,a.isMsgShow=!0)})},a.fnInitBillingHistory=function(){"billingHistory"==b.settingsName&&a.getPagedDataAsync()},a.billingHistoryGridOptions={data:"billingHistoryData",rowHeight:50,multiSelect:!1,enableRowSelection:!0,enableRowHeaderSelection:!1,enableVerticalScrollbar:0,columnDefs:[{field:"date",displayName:"Date",minWidth:150,cellFilter:"date:'dd-MM-yyyy'",enableHiding:!1},{field:"reference",displayName:"Invoice #",minWidth:100,enableHiding:!1},{field:"description",displayName:"Description",minWidth:250,enableHiding:!1},{field:"amount",displayName:"Amount",minWidth:100,enableHiding:!1}],onRegisterApi:function(b){b.selection.on.rowSelectionChanged(a,function(a){a.isSelected=!0})}},a.fnBillingHistoryDelete=function(a,b,c){var d=c.confirm().title("Delete").content("Would you like to delete this billingHistory?").ariaLabel("Delete").ok("Delete").cancel("Cancel").targetEvent(b);c.show(d).then(function(){})},a.fnBillingHistoryEdit=function(){}}]),app.controller("ManageUsersCtrl",["$scope","$rootScope","toastr","userService","locationService",function(a,b,c,d,e){a.isProcessing=!1,d.getUserObj().id?(a.user=angular.copy(d.getUserObj()),a.user.verified="true"===d.getUserObj().verified,d.setUserObj({})):a.user={name:"",email:"",role:"User",defaultLocation:"",customerContact:"false",verified:""},a.fnInitUser=function(){a.fnFetchLocations()},a.fnSaveUser=function(e){var f=null;e.id&&(f=e.id),a.isProcessing=!0,a.userForm.$invalid=!0,d.saveUser(f,e).then(function(d){null===d.data?(c.success("User saved successfully."),null===f&&a.fnResetForm(),a.isProcessing=!1,a.userForm.$invalid=!1,b.$broadcast("refreshUsers"),a.fnCloseSwap()):a.isProcessing=!1})},a.fnResetForm=function(){a.user={role:"User",customerContact:!1,verified:!1},a.userForm.name.$touched=!1,a.userForm.email.$touched=!1,a.fnFetchLocations()},a.fnFetchLocations=function(){e.fetchLocation().then(function(b){a.locations=b,a.user.id||(a.user.defaultLocation=b[0].id)})}}]),app.controller("paymentInfoCtrl",["$scope","$state","$rootScope","$mdDialog","paymentService",function(a,b,c,d,e){function f(d){e.savePaymentInfo(d).then(function(){"accountsettings"===b.current.name?(c.$broadcast("refreshFetchAccount"),a.hide()):b.go("dashboard")})}a.hide=function(){d.hide()},a.paymentInfo={type:"",number:"",exp_month:"",exp_year:"",cvv:""},ChargeIO.init({public_key:"m_zuT9A5oAQTilLxkc_PWanQ"}),a.updateUserPaymentInfo=function(){ChargeIO.create_token(a.paymentInfo,f,function(a){console.log(a.error.message)})}}]),angular.module("rsmtPortalApp").run(["$templateCache",function(a){a.put("views/authenticated/main.html",'<md-toolbar class="top-header" ng-init="fnInitMain()"> <div class="md-toolbar-tools"> <md-button ng-click="fnToggleSideNav(\'left\')" hide-gt-sm class="md-icon-button"> <md-icon md-font-set="fa fa-lg fa-fw fa-bars"></md-icon> </md-button> <div layout="row"> <img class="img-responsive rsmt-logo" alt="Repair Shop Marketing Tools" src="images/rsmt-full-logo.860fabb7.png"> </div> <md-menu md-position-mode="target-right target"> <md-button ng-click="$mdOpenMenu($event)"> <span ng-bind="userObj.name"></span><md-icon md-font-set="fa fa-lg fa-fw fa-angle-down" style="font-weight: 900"></md-icon> </md-button> <md-menu-content width="3"> <md-menu-item> <md-button ng-click="fnStateSettings();"> <div layout="row"> <p flex> <md-icon class="margin-right-5" md-font-set="fa fa-lg fa-fw fa-cog"></md-icon> Settings </p> </div> </md-button> </md-menu-item> <md-menu-item> <md-button ng-click="fnOpenTermsOfServiceModal($event);"> <div layout="row"> <p flex> <md-icon class="margin-top-5 margin-left-3 margin-right-5" md-font-set="fa fa-fw fa-file"></md-icon> Terms of Use </p> </div> </md-button> </md-menu-item> <md-menu-item> <md-button ng-click="fnLogout();"> <div layout="row"> <p flex> <md-icon class="margin-right-5" md-font-set="fa fa-lg fa-fw fa-power-off"></md-icon> Sign out </p> </div> </md-button> </md-menu-item> </md-menu-content> </md-menu> </div> </md-toolbar> <md-content layout="row" flex> <!-- Left Side Navigation : START--> <md-sidenav class="left-side-nav md-sidenav-left md-whiteframe-z2" layout="column" md-component-id="left" md-is-locked-open="$mdMedia(\'gt-sm\')"> <md-button class="md-primary" ng-class="fnIsActive(\'/dashboard\')" ng-if="fnCheckSubscription(userSubscriptions,\'realtime_dashboard\')" ng-click="$root.fnCloseSideNavs();" ui-sref="main.dashboard"> <md-icon md-font-set="fa fa-lg fa-fw fa-dashboard"></md-icon>&nbsp;Dashboard</md-button> <md-button class="md-primary" ng-class="fnIsActive(\'/locations\')" ng-click="$root.fnCloseSideNavs();" ui-sref="main.locations"> <md-icon md-font-set="fa fa-lg fa-fw fa-map-marker"></md-icon>&nbsp;Locations</md-button> <md-button class="md-primary" ng-class="fnIsActive(\'/crm\')" ng-if="fnCheckSubscription(userSubscriptions,\'crm_scheduled\')" ng-click="$root.fnCloseSideNavs();" ui-sref="main.crm"> <md-icon md-font-set="fa fa-lg fa-fw fa-users"></md-icon>&nbsp;CRM</md-button> <md-button class="md-primary" ng-class="fnIsActive(\'/products\')" ng-click="$root.fnCloseSideNavs();" ui-sref="main.products"> <md-icon md-font-set="fa fa-lg fa-fw fa-product-hunt"></md-icon>&nbsp;Products</md-button> <md-button class="md-primary" ng-class="fnIsActive(\'/location/setup\')" ng-if="fnCheckSubscription(userSubscriptions,\'realtime_dashboard\')" ng-click="$root.fnCloseSideNavs();" ui-sref="main.locationSetup"> <md-icon md-font-set="fa fa-lg fa-fw fa-wrench"></md-icon>&nbsp;Location Setup</md-button> </md-sidenav> <!-- Left Side Navigation : END--> <!-- Body content --> <md-content id="content" class="overflow-auto" layout="column" ui-view flex></md-content> </md-content>'),a.put("views/header.html",'<div class="md-toolbar-tools" ng-controller="HeaderCtrl"> <div layout="row"> <img class="img-responsive rsmt-logo" alt="Repair Shop Marketing Tools" src="images/rsmt-full-logo.860fabb7.png"> </div> <div layout="row" layout-align="end center" flex> <md-button class="md-accent md-raised md-hue-2" ng-click="showSignup($event)">Sign Up Here</md-button> </div> </div>'),a.put("views/login.html",'<md-toolbar layout="row" ng-include="\'views/header.html\'"></md-toolbar> <md-content> <div style="min-height: 20px"> <md-progress-linear class="md-accent" ng-if="user.isProcessing" md-mode="indeterminate"></md-progress-linear> </div> <div class="overflow-auto" layout="column" layout-align="space-between center" flex> <div class="md-whiteframe-z1 md-padding center-form-container" layout-margin> <div class="md-display-1 text-center" layout-padding>Sign In</div> <form name="signInForm" layout="column" novalidate> <md-input-container class="remove-error-space"> <md-icon class="md-accent margin-top-10" md-font-set="fa fa-lg fa-fw fa-user"></md-icon> <input type="email" name="email" placeholder="Email" ng-model="user.email" required> <div ng-if="signInForm.$submitted || signInForm.email.$touched"> <span class="error-msg" ng-if="signInForm.email.$error.required">Email is required.</span> <span class="error-msg" ng-if="signInForm.email.$error.email">This field must be a valid email address.</span> </div> </md-input-container> <md-input-container class="remove-error-space"> <md-icon class="md-accent margin-top-10" md-font-set="fa fa-lg fa-fw fa-lock"></md-icon> <input type="password" name="password" placeholder="Password" ng-model="user.password" required> <div ng-if="signInForm.$submitted || signInForm.password.$touched"> <span class="error-msg" ng-if="signInForm.password.$error.required">Password is required.</span> </div> </md-input-container> <div layout="column" layout-align="center center"> <div layout="row"> <md-button type="submit" class="md-raised md-accent" ng-disabled="user.isProcessing" ng-click="signInForm.$valid && fnSignInUser(user);"> Sign In </md-button> </div> <div layout="row"> <md-button class="md-accent" ng-click="fnForgotPassword($event);"> Forgot Your Password ? </md-button> </div> </div> </form> </div> </div> </md-content>'),a.put("views/modals/forgotPassword.html",'<md-dialog class="forgot-password-dialog" aria-label="Forgot Password Modal"> <md-toolbar> <div class="md-toolbar-tools" layout="row" layout-align="space-between center"> <span class="md-title">Forgot Password</span> <md-button class="md-icon-button" ng-click="fnCancel();"> <md-icon md-font-set="fa fa-lg fa-fw fa-close"></md-icon> <md-tooltip ng-if="$root.isMobile == null" md-direction="top">Close</md-tooltip> </md-button> </div> </md-toolbar> <div class="md-padding"> <form name="forgotPasswordForm" layout="column" novalidate> <md-dialog-content> <p class="text-justify"> Enter the email you registered with us previously and we\'ll send you an email with instructions on how to reset your password.</p> <div layout="row"> <md-input-container flex> <md-icon class="md-accent margin-top-10" md-font-set="fa fa-lg fa-fw fa-envelope"></md-icon> <input type="email" name="resendEmail" ng-model="resendEmail" ng-minlength="5" placeholder="Your email address" required> <div ng-if="forgotPasswordForm.$submitted || forgotPasswordForm.resendEmail.$touched"> <span class="error-msg" ng-if="forgotPasswordForm.resendEmail.$error.required"> Email is required.</span> <span class="error-msg" ng-if="forgotPasswordForm.resendEmail.$error.email"> This field must be a valid email address.</span> </div> </md-input-container> </div> </md-dialog-content> <md-dialog-actions class="padding-right-0"> <md-button type="submit" class="md-raised md-accent" ng-click="forgotPasswordForm.$valid && fnResendMail(resendEmail);"> Send Email </md-button> <md-button class="md-warn md-raised margin-right-0" ng-click="fnHide()">Cancel</md-button> </md-dialog-actions> </form> </div> </md-dialog>'),a.put("views/modals/idleSession.tmpl.html",'<md-dialog aria-label="Idle Session Template"> <md-toolbar> <div class="md-toolbar-tools">You\'re Idle Too Long...!!</div> </md-toolbar> <md-dialog-content class="md-padding"> <div ng-init="countdown = 120"> <div ng-if="countdown <= 30"> You\'ll be logged out in {{countdown}} second(s). </div> <div ng-if="countdown > 30"> {{minRemaining}} minutes remaining. </div> </div> <md-progress-linear class="md-warn margin-top-10" md-mode="determinate" ng-value="countdown"> </md-progress-linear> </md-dialog-content> <md-dialog-actions layout-margin> <md-button class="md-raised md-accent" ng-click="extendSession();">Stay logged in</md-button> </md-dialog-actions> </md-dialog>'),a.put("views/modals/signup.html",'<md-dialog aria-label="Sign Up" class="fullScreenDialog"> <form name="businessForm" novalidate> <md-toolbar> <div class="md-toolbar-tools"> <span>Partner Sign-up</span> <span flex></span> <md-button class="md-icon-button" ng-click="fnCancel();"> <md-icon md-font-set="fa fa-lg fa-fw fa-close"></md-icon> <md-tooltip ng-if="$root.isMobile == null" md-direction="top">Close</md-tooltip> </md-button> </div> </md-toolbar> <md-dialog-content> <div class="md-dialog-content md-padding" layout="column"> <md-input-container class="remove-error-space"> <label>Business Name</label> <input name="businessName" ng-model="user.businessName" ng-minlength="5" required> <div ng-if="businessForm.$submitted || businessForm.businessName.$touched"> <span class="error-msg" ng-if="businessForm.businessName.$error.required"> Business Name is required.</span> <span class="error-msg" ng-if="businessForm.businessName.$error.minlength"> This field is too short minimum 5 character required.</span> </div> </md-input-container> <md-input-container class="remove-error-space"> <label>Business Zip</label> <input name="businessZip" ng-model="user.businessZip" required ng-pattern="/^[0-9]+$/" ng-minlength="5" ng-maxlength="20"> <div ng-if="businessForm.$submitted || businessForm.businessZip.$touched"> <span class="error-msg" ng-if="businessForm.businessZip.$error.required"> Business Zip is required.</span> <span class="error-msg" ng-if="businessForm.businessZip.$error.pattern"> This field must contain number only.</span> <span class="error-msg" ng-if="businessForm.businessZip.$error.minlength"> This field is too short minimum 5 character required.</span> <span class="error-msg" ng-if="businessForm.businessZip.$error.maxlength"> This field is too long maximum 20 character required.</span> </div> </md-input-container> <md-input-container class="md-block"> <label>Business Timezone</label> <md-select ng-model="user.businessTimezone"> <md-option ng-repeat="timezone in timeZoneDDOptions" ng-value="timezone"> {{timezone}} </md-option> </md-select> </md-input-container> <md-input-container class="remove-error-space"> <label>Business Website</label> <input name="businessUrl" ng-model="user.businessUrl" required ng-pattern="/^\\w+([\\.-]?\\w+)*\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/"> <div ng-if="businessForm.$submitted || businessForm.businessUrl.$touched"> <span class="error-msg" ng-if="businessForm.businessUrl.$error.required"> Business Website is required.</span> <span class="error-msg" ng-if="businessForm.businessUrl.$error.pattern"> This field must be a valid url.</span> </div> </md-input-container> <md-input-container class="remove-error-space"> <label>Contact Name</label> <input name="contactName" ng-model="user.contactName" required ng-minlength="6" ng-pattern="/^[A-Za-z ]+$/"> <div ng-if="businessForm.$submitted || businessForm.contactName.$touched"> <span class="error-msg" ng-if="businessForm.contactName.$error.required"> Contact Name is required.</span> <span class="error-msg" ng-if="businessForm.contactName.$error.pattern"> This field must contain alphabets only.</span> <span class="error-msg" ng-if="businessForm.contactName.$error.minlength"> This field is too short minimum 6 character required.</span> </div> </md-input-container> <md-input-container class="remove-error-space"> <label>Contact Email</label> <input name="contactEmail" type="email" ng-model="user.contactEmail" required> <div ng-if="businessForm.$submitted || businessForm.contactEmail.$touched"> <span class="error-msg" ng-if="businessForm.contactEmail.$error.required"> Contact Email is required.</span> <span class="error-msg" ng-if="businessForm.contactEmail.$error.email"> This field must be a valid email address.</span> </div> </md-input-container> <md-input-container class="remove-error-space"> <label>Password</label> <input name="passwd" type="password" ng-model="user.password" required minlength="5"> <div ng-if="businessForm.$submitted || businessForm.passwd.$touched"> <span class="error-msg" ng-if="businessForm.passwd.$error.required"> Password is required.</span> <span class="error-msg" ng-if="businessForm.passwd.$error.minlength"> This field is too short minimum 5 character required.</span> </div> </md-input-container> <md-input-container> <label>Password Again</label> <input name="confirmPassword" type="password" ng-model="user.confirmPassword" data-password-verify="user.password" required> <div ng-if="businessForm.$submitted || businessForm.confirmPassword.$touched"> <span class="error-msg" ng-if="businessForm.confirmPassword.$error.required">Confirm Password is required.</span> <span class="error-msg" ng-if="businessForm.confirmPassword.$error.passwordVerify">Password don\'t match.</span> </div> </md-input-container> <span> <md-checkbox md-no-ink aria-label="Checkbox No Ink" name="termsAgreed" ng-model="agreed" class="md-accent" required> <a ng-click="fnOpenTermsOfServiceModal($event);" href="javascript:void(0);">Agree to Terms</a> </md-checkbox> <div ng-if="businessForm.$submitted || businessForm.termsAgreed.$touched"> <span class="error-msg" ng-if="businessForm.termsAgreed.$error.required"> Please agree the terms & conditions.</span> </div> </span> <div><span class="text-danger"> {{ error }}</span></div> </div> </md-dialog-content> <md-dialog-actions layout-margin> <md-progress-circular class="md-accent" ng-if="isProcessing" md-mode="indeterminate"></md-progress-circular> <md-button type="submit" class="md-raised md-accent" ng-disabled="isProcessing" ng-click="businessForm.$valid && fnRegisterUser(user);"> Create Partner Account </md-button> <md-button class="md-warn md-raised" ng-click="fnHide();">Cancel</md-button> </md-dialog-actions> </form> </md-dialog>'),
a.put("views/modals/termsOfServiceDialog.html",'<md-dialog id="terms-of-service-dialog" class="fullScreenDialog" aria-label="termsOfServiceDialog"> <md-toolbar> <div class="md-toolbar-tools"> <span>Terms & Conditions</span> <span flex></span> <md-button class="md-icon-button" ng-click="hide();"> <md-icon md-font-set="fa fa-lg fa-fw fa-close"></md-icon> <md-tooltip ng-if="$root.isMobile == null" md-direction="top">Close</md-tooltip> </md-button> </div> </md-toolbar> <md-dialog-content> <div md-theme="grey" class="md-dialog-content"> <md-tabs class="md-primary" md-dynamic-height md-border-bottom md-selected="selectedTab"> <md-tab label="Terms of Use"> <md-content> <p> The Repair Shop Marketing Tools Dashboard is a website, an online service, a mobile service, and ShopSync Agent Software of Repair Shop Marketing Tools LLC ("RSMT", "we", "us"). These terms outline the manner by which you may use the RSMT Dashboard web site at <a href="http://www.repairshopmarketingtools.com/dashboard">http://www.repairshopmarketingtools.com/dashboard</a> (the "Site"), the mobile software, or any other software or services owned by RSMT (collectively with the Site, "Service"). Please read the following Terms of Use carefully before using the RSMT Dashboard or any related services. </p> <h3>1. ACCEPTANCE OF TERMS</h3> <p>By accessing or using the Service in any manner, including but not limited to visiting or browsing the Site, or by downloading the ShopSync Agent, you ("you", "your", "User") are signifying that you have read, understand and agree to be bound by this Terms of Use ("Agreement"), whether or not you are a registered user. This Agreement applies to all users of the Service.</p> <p>The Service is available only to individuals who are at least 15 years old. By using the Service you represent and warrant that you are (i) at least 15 years old and (ii) if you are a minor between 15 and 18, you have parental permission to enter into this Agreement and use the Service.</p> <p>We reserve the right, at our sole discretion, to modify or replace any of these Terms at any time, or change, suspend, or discontinue the Service at any time by posting a notice on the site, sending you notice through the Site or email. We may also impose limits to certain features or restrict your access to all or parts of the Service without notice or liability. It is your responsibility to periodically check this Agreement for any changes. Your continued use of the Service following any changes to this Agreement constitutes your acceptance of those changes.</p> <h3>2. ACCESS</h3> <p>Subject to the terms and conditions of this Agreement, we may offer to provide the Service to you solely, and not for the use or benefit of any third party. Services shall include, but are not limited to, use of the website, use of mobile services or software, use of the ShopSync Agent, or any service RSMT performs for you. You shall not reverse assemble, reverse compile, reverse engineer, or otherwise attempt to discover any Service source code or underlying proprietary information.</p> <h3>3. OWNER ACCOUNTS</h3> <p>As a condition to using the Service, you are required to register at least one Owner Account on the RSMT service. You shall provide RSMT with accurate, complete, and up-to-date information for the business owner as well as the business location, including your email address and business physical address. Failure to do so constitutes a breach of this Agreement, and may result in termination of your account possibly resulting in the loss of data. You shall not (i) provide information belonging to another person with the intent to impersonate that person, or (ii) provide information that is subject to any rights of a person other than you without appropriate authorization, or (iii) provide information that is otherwise offensive, vulgar or obscene. RSMT reserves the right to refuse registration or cancel an account in its sole discretion. </p> <p>The user shall be responsible for maintaining the confidentiality of the user\'s password. The user is responsible for all activity conducted through the user\'s account and agrees to release RSMT from any and all liability related to such activity. The user agrees to notify us in writing if there is a suspected or actual loss, theft, or unauthorized use of the user\'s account.</p> <h3>4. ADMINISTRATOR AND USER ACCOUNTS</h3> <p>The Dashboard allows you to create additional users that will have access to your account and account data. Additional users that you create may have the ability to damage the functioning of the system and cause data loss. RSMT’s responsibilities do not extend to your internal management or administration of the Services. For any accounts that you create, you are responsible for the confidentiality of the passwords and for ensuring that other individuals that access the system through these accounts do so in accordance with these Terms.</p> <h3>5. YOUR DATA</h3> <p>Use of the Service depends on the transmission of certain Data (your “Data”) either via the ShopSync Agent or through the use of other third-party APIs. You retain all rights and ownership to your Data within our system. By providing your Data to RSMT, you represent and warrant that you have all the necessary rights and licenses to make your Data available in this manner, and that by doing so you are not violating any third-party intellectual property rights, confidential relationships, contractual obligations, or laws. You are solely responsible for ensuring that transmission or processing of your Data does not violate any applicable laws. </p> <p>You are solely responsible for ensuring that your Data does not include any (i) government issued identification numbers such as driver’s license numbers or social security numbers, (ii) payment card information such as credit or debit card numbers, or (iii) financial account information such as bank account numbers.</p> <p>RSMT also offers products that allows you to make certain subsets of your Data available to your customers. These products make it possible for your customers to see their vehicle’s service history online. If you are subscribed to these products, your customers are verified using their phone numbers or email addresses by sending a validation code via an email or SMS (text message). Once access has been granted to a customer, they have the freedom to export their data or move it to an external service.</p> <h3>6. RESTRICTIONS</h3> <p>The User is responsible for all activity in connection with the Service. Any fraudulent, abusive, or otherwise illegal activity or any use of the Service that violates this Agreement may be grounds for termination of the Service. Additionally, the user shall not (i) attempt to gain unauthorized access to any portion or feature of the service, (ii) frame or mirror any part of the Service without prior and explicit written consent, (iii) probe, scan, or test for vulnerabilities of the Service, (iv) take any action that applies a disproportionately large load on the Service, (v) use any device software or routine to interfere or attempt to interfere with the proper working of the Service, (vi) use the Service to post or transmit any content that is infringing, libelous, defamatory, obscene, pornographic, abusive, offensive, profane, or otherwise violates the law or right of any third party, (vii) use the Service to send unsolicited advertising, junk or bulk emails, (viii) use the Service to harass, stalk, or abuse any person, (ix) create a false identity or impersonate another person. The user shall abide by all applicable local, state, national and international laws and regulations.</p> <h3>7. PRIVACY</h3> <p>Please review our Privacy Policy. By using the service you are agreeing to be bound by the information and notices contained therein. By using the Service, you are also consenting to have your personal data transferred to and processed in the U.S.</p> <h3>8. SECURITY</h3> <p>RSMT will take reasonable security precautions when using the internet, telephone, or other means to transport data or communications, but expressly disclaims any and all liability for the accessing of any such data communications by unauthorized persons or entities. You acknowledge that you provide your personal information at your own risk.</p> <h3>9. SUBSCRIPTIONS AND PAYMENT</h3> <p>Each RSMT product requires its own subscription and has its own price that is due to be paid on a monthly basis. See the product pricing schedule for details regarding the price of an individual product subscription. Each month, the total amount due is the sum of all current subscriptions. All subscriptions auto-renew each year. If the client wishes to terminate a subscription, they must provide thirty (30) days notice prior to the desired termination date.</p> <p>In order to subscribe to any service provided by RSMT, the Client must have a valid credit card associated with their Owner Account. The Client authorizes and consents to charges made to your associated credit card as payment for the Services provided by RSMT. RSMT will deliver a receipt via email for each charge made to the associated credit card.</p> <p>In the event of a disputed charge, RSMT must receive a written notice within ten (10) business days. The notice must provide reasonable information regarding the details of the disputed charge.</p> <h3>10. WARRANTY DISCLAIMER</h3> <p>THE SERVICE IS PROVIDED TO YOU ON AN "AS IS" AND "AS AVAILABLE" BASIS AND WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF TITLE, NON-INFRINGEMENT, MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, AND ANY WARRANTIES IMPLIED BY ANY COURSE OF PERFORMANCE OR USAGE OF TRADE, ALL OF WHICH ARE EXPRESSLY DISCLAIMED. RSMT, ITS EMPLOYEES, DIRECTORS, AND PARTNERS DO NOT WARRANT THAT THE SERVICE WILL BE: (1) AVAILABLE OR SECURE, (2) RELIABLE OR CORRECT, (3) THE SERVICE WILL MEET YOUR REQUIREMENTS, (4) THAT ANY DEFECT OR ERRORS WILL BE CORRECTED, (5) OR THAT THE SERVICE IS FREE FROM VIRUSES OR OTHER HARMFUL COMPONENTS.</p> <p>SOME STATES DO NOT ALLOW LIMITATIONS ON IMPLIED WARRANTIES, SO THE ABOVE LIMITATIONS MAY NOT APPLY TO YOU.</p> <h3>11. INDEMNIFICATION</h3> <p>You agree that you are solely responsible for all of your actions in connection with RSMT. You agree to defend, indemnify, and hold harmless RSMT, its employees, directors, contractors, affiliates, and representatives from and against any and all liabilities, claims, expenses, including but not limited to reasonable attorney\'s fees arising from (i) your use or misuse of the Service, or (ii) your access to any part of the Service, or (iii) your violation of any term of this Agreement.</p> <h3>12. LIMITATION OF LIABILITY</h3> <p>TO THE MAXIMUM EXTENT ALLOWED BY LAW, IN NO EVENT SHALL RSMT, ITS EMPLOYEES, DIRECTORS, CONTRACTORS, AFFILIATES, OR PARTNERS BE LIABLE UNDER CONTRACT, TORT, STRICT LIABILITY, NEGLIGENCE OR ANY OTHER LEGAL OR EQUITABLE THEORY WITH RESPECT TO THE SERVICE (I) FOR ANY LOST PROFITS, DATA LOSS, COST OF PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES, OR SPECIAL, INDIRECT, INCIDENTAL, PUNITIVE, OR CONSEQUENTIAL DAMAGES OF ANY KIND WHATSOEVER, (II) FOR ANY BUGS, VIRUSES, TROJAN HORSES, OR THE LIKE (REGARDLESS OF SOURCE OF ORIGINATION), OR (III) FOR ANY DAMAGES IN EXCESS (IN THE AGGREGATE) ONE-HUNDRED U.S. DOLLARS. SOME STATES DO NOT ALLOW THE EXCLUSION OR LIMITATION OF INCIDENTAL OR CONSEQUENTIAL DAMAGES, SO THE ABOVE LIMITATIONS AND EXCLUSIONS MAY NOT APPLY TO YOU.</p> <h3>13. TERMINATION</h3> <p>RSMT may terminate your access to all or part of the Service, with or without cause, with or without notice, effective immediately, which may result in the forfeiture and destruction of all information associated with your use of the Service. Sections 9, 10, and 11 shall survive termination. Other provisions of these Terms of Use which by their nature should survive termination shall also survive termination.</p> <h3>14. MISCELLANEOUS</h3> <p>This Agreement (including the Privacy Policy), as modified from time to time, constitutes the entire agreement between you and RSMT. The Agreement replaces any contemporaneous understandings or agreements, written or oral, regarding the subject matter hereof. The failure of either party to exercise in any respect any right provided for herein shall not be deemed a waiver of any further rights hereunder. If any provisions of this Agreement is found to be unenforceable or invalid, that provision shall be limited or eliminated to the minimum extent necessary so that the remainder of the Agreement shall remain in full force and effect and enforceable. These Terms of Use are personal to you, and are not assignable, transferable, or sublicensable by you except with RSMT’s prior written consent. RSMT shall not be liable for any failure to perform its obligations hereunder where such failure results from any cause beyond RSMT\'s reasonable control, including, without limitation, mechanical, electronic or communications failure or degradation. No agency, partnership, employment, or joint venture is created as a result of this agreement and the user does not have any authority of any kind to bind RSMT in any respect whatsoever.</p> <h5>Effective: December 1, 2015</h5> </md-content> </md-tab> <md-tab label="Privacy Policy"> <md-content> <p>RSMT values your privacy. This privacy policy covers the collection and use of your personal information any time you interact with the RSMT website or the RSMT team.</p> <h3>1. ACCOUNT CREATION</h3> <p>In an effort to minimize the need to remember another password, RSMT requires that a user associate their RSMT account with one of their existing accounts such as Facebook, GMail (Google\'s email service), or another OpenID provider (referred to as \'authentication providers\' below). RSMT has no formal affiliation with these authentication providers and simply uses standard and accepted mechanisms to integrate with them.</p> <p>When you sign-in using one of these auth providers, you will be directed to a website external to the RSMT website where you provide your login credentials (usually a username and password). Upon success you will be redirected back to the RSMT website. As a result of this sign-in process, RSMT is provided with a unique user identifier (usually a number), your email address, and possibly your first and last name (Facebook only). RSMT never has access to your password. If you want to discontinue the use of a third-party authentication provider, you will need to do so using their website.</p> <p>RSMT doesn\'t use any social data that may be available using these third-party authentication providers. For example, we never attempt to access your list of Facebook friends.</p> <h3>2. INFORMATION COLLECTED</h3> <p>RSMT is designed to make management of your vehicles as simple as possible. The information we collect is intended to help us achieve this goal.</p> <p>When you visit the RSMT website, certain information is logged regarding your visit: the time and day of the visit, your IP address, the operations you performed while on the site, and any errors that may have occurred. This information is required to ensure proper functioning of the website.</p> <p>Additionally, anonymous demographic data is also collected such as your approximate location, your web browser type, your operating system, pages visited, and duration of visit.</p> <p>Also, we collect any information you directly provide to us. This includes, but is not limited to: your first and last name, postal (zip) code, vehicle make/model, vehicle year, vehicle mileage, vehicle color, and vehicle purchase price. When you use RSMT to record information about a refueling we record the date and time of refueling, vehicle mileage at refueling, fuel cost, fuel amount, and refuel location. When you use RSMT to record maintenance we record the date and time of the maintenance, the vehicle\'s mileage, the cost, the location, and an itemized list of the type of maintenance completed.</p> <h3>3. INFORMATION USE</h3> <p>Other possible uses include those that provide new services to all RSMT users. For example, we may use your provided information to help other users answer questions like "how much do other Ford F-150 owners pay for an oil change?".</p> <p>When you use the mobile version of the website (browse to <a href="http://repairshopmarketingtools.com/dashboard">http://repairshopmarketingtools.com/dashboard</a> using your iPhone or Android phone) to record a refueling or other maintenance, the app may record the business location using the GPS sensor in your phone. Your browser will ask for your permission before it allows access to the GPS functionality. We use this information to provide you with greater context when you\'re inspecting your vehicle\'s refueling or maintenance history. This information is helpful when you what to answer questions like "where did I get my oil changed last?", or "did I like the business that gave me my last tune-up?". In addition, we may also use this location information to answer other user\'s questions like "where do other BMW owners take their cars for service?". In this case, we\'ll never give access to any personally identifying information. If you deny the use of your location when your browser requests access, you\'ll still be able to give a name to your current location and RSMT will still maintain a list of "recently visited" for you. In which case, there is no specific location information stored.</p> <p>We never provide your personal data to any third-parties. We may, however, provide aggregated and anonymous data to third-parties. For example, we may aggregate your and other\'s data in order to share information such as "how many people in Austin, Texas drive Chevys".</p> <h3>4. SECURITY</h3> <p>RSMT is committed to the security of your information and takes reasonable precautions to protect it. However, no data transmitted over the internet can be 100% secure. As a result, any information you provide to RSMT is done at your own risk.</p> <h3>5. COOKIES</h3> <p>Cookies are pieces of information retrieved from our servers and stored on your hard drive. These cookies are sent back to us each time your browser sends a request to our servers. We require the use of cookies to know the identity of the user that is making a particular request. There is usually no identifying information stored in these cookies. Usually they are just random characters such as "ads3msj3d-26ms2". If you login with Facebook, however, a cookie will be created that contains your Facebook userid. This is usually just a number, but it can be used to identify you on Facebook. If you use Facebook to sign into RSMT (or any website), you should always remember to sign out.</p> <p>RSMT uses Google Analytics in order to understand who is using the Service. Google Analytics uses cookies to keep track of things such as browser type, IP address, time spent on each page, and type of operating system. Google has created a browser plugin you can use to opt-out: opt-out of Google Analytics.</p> <p>Most browsers allow you to turn off cookies. Doing so will likely affect your ability to access and use RSMT.</p> <h3>6. INTERNATIONAL USERS</h3> <p>While RSMT does not currently provide a service suitable for international users, such users should be warned that if they enter personal information into RSMT, that information will be transmitted to and stored in the US and the US may have less restrictive requirements regarding the use of your data.</p> <h3>7. CHANGES</h3> <p>This Privacy Policy will likely change over time. Please check back occasionally to see what\'s changed. We\'ll post the current effective date at the top of this document so you will know when changes were last made.</p> <h3>8. CONTACT</h3> <p>Any questions regarding this Privacy Policy should be sent to privacy@rsmt.com</p> <h5>Effective: January 1, 2011</h5> </md-content> </md-tab> </md-tabs> </div> </md-dialog-content> </md-dialog>'),a.put("views/resetPassword.html",'<md-toolbar layout="row" ng-include="\'views/header.html\'"></md-toolbar> <md-content> <div style="min-height: 20px"> <md-progress-linear class="md-accent" ng-if="pass.isProcessing" md-mode="indeterminate"></md-progress-linear> </div> <div class="overflow-auto" layout="column" layout-align="space-between center" flex> <div class="md-whiteframe-z1 md-padding center-form-container" layout-margin> <div class="md-display-1 text-center" layout-padding>Reset Password</div> <div class="md-subhead text-center" layout-padding>Enter your new password below.</div> <form name="resetPasswordForm" layout="column" novalidate> <md-input-container class="remove-error-space"> <md-icon class="md-accent">lock</md-icon> <input type="password" placeholder="Password" name="password" ng-model="pass.password" minlength="5" required> <div ng-if="resetPasswordForm.$submitted || resetPasswordForm.password.$touched"> <span class="error-msg" ng-if="resetPasswordForm.password.$error.required">Password is required.</span> <span class="error-msg" ng-if="resetPasswordForm.password.$error.minlength"> Password is too short minimum 5 characters required.</span> </div> </md-input-container> <md-input-container class="remove-error-space"> <md-icon class="md-accent">lock</md-icon> <input name="retypePassword" placeholder="Re-type Password" type="password" ng-model="pass.retypePassword" required data-password-verify="pass.password"> <div ng-if="resetPasswordForm.$submitted || resetPasswordForm.retypePassword.$touched"> <span class="error-msg" ng-if="resetPasswordForm.retypePassword.$error.required"> Retype Password is required.</span> <span class="error-msg" ng-if="resetPasswordForm.retypePassword.$error.passwordVerify"> Password don\'t match.</span> </div> </md-input-container> <div layout="column" layout-align="center center"> <div layout="row"> <md-button type="submit" class="md-raised md-accent" ng-disabled="pass.isProcessing" ng-click="resetPasswordForm.$valid && fnResetPassword(pass);"> Reset Password </md-button> </div> </div> </form> </div> </div> </md-content>')}]);